import{a as Ut,b as qt}from"./chunk-PLBDP4AG.js";import{C as kt,I as je,J as we,L as Pe,N as $,O as G,Y as Oe,Z as ke,_ as Ve,aa as Rt,b as W,c as Q,ca as $t,ea as Gt,y as Tt,z as Mt}from"./chunk-QYVUAEAA.js";import{B as de,C as P,Ca as Nt,Da as yt,E as V,H as L,Ia as Z,J as bt,L as R,La as ne,Oa as ye,Sa as Te,Ta as Me,U as ie,Va as jt,Wa as O,Xa as wt,Ya as Pt,_a as ue,ab as Vt,bb as Lt,ha as St,oa as fe,qa as he,ra as xt,s as y,ta as Ie,u as k,v as I,va as Ne,w as j,wa as ge,x as w,ya as It,z as At}from"./chunk-HCTXQRD3.js";import{$a as r,$b as J,$f as T,Ca as s,Da as f,E as ct,Ea as A,Ga as ft,Hb as Et,Hc as vt,Ib as Ft,Ic as H,Jc as zt,Kb as Bt,La as a,Lb as S,Lc as Se,Ma as ht,Mc as ce,Ng as K,Og as Ot,P as mt,Sc as qe,Ua as E,W as pt,Zf as me,_a as u,_b as te,_f as pe,aa as Ae,ab as h,d as Yt,da as le,e as Be,ea as z,eb as B,fa as be,ia as dt,ib as d,ja as _,ka as C,kb as g,lf as xe,nf as b,of as N,pb as v,qb as m,qf as x,rb as se,sb as ve,tb as gt,v as st,vg as M,wb as F,xb as Dt,yb as _t,zb as Ct}from"./chunk-7CJ5GJTD.js";var Fe=Yt(Jt=>{"use strict";var oi=function(){function n(){}return n.UUID=function(){if(typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.getRandomValues<"u"){var o=new Uint16Array(8);return window.crypto.getRandomValues(o),this.pad4(o[0])+this.pad4(o[1])+"-"+this.pad4(o[2])+"-"+this.pad4(o[3])+"-"+this.pad4(o[4])+"-"+this.pad4(o[5])+this.pad4(o[6])+this.pad4(o[7])}else return this.random4()+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+this.random4()+this.random4()},n.pad4=function(o){for(var l=o.toString(16);l.length<4;)l="0"+l;return l},n.random4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)},n}();Jt.UUID=oi});function ei(n,o){n&1&&(u(0,"se",10),h(1,"input",11),r())}function ti(n,o){n&1&&(u(0,"se",12),h(1,"input",13),r())}function ii(n,o){n&1&&(u(0,"se",14),h(1,"input",15),r())}function ni(n,o){n&1&&(u(0,"se",16),h(1,"input",17),r())}function ui(n,o){n&1&&(u(0,"se",18),h(1,"input",19),r())}var He=(()=>{let o=class o{constructor(e,i,t,c,p,D){this.fb=e,this.msg=i,this.activatedRouter=t,this.http=c,this.modalSrv=p,this.cdr=D,this.loading=!0,this.list=[],this.projectId="",this.project=null,this.submitting=!1,this.activatedRouter.queryParams.subscribe(q=>{this.projectId=q.projectId})}ngOnInit(){this.form=this.fb.group({EnableInfluxDB:!1,InfluxDBAddress:"",InfluxDBOrganizationId:"",InfluxDBBucketName:"",InfluxDBMeasurement:"",InfluxDBAccessToken:""}),this.http.post("controlpanel/www",{function:"GetProject",projectId:this.projectId}).subscribe(e=>{e.Status==200?(e.Data!=null?(this.project=e.Data,this.project.DataStorage==null&&(this.project.DataStorage={EnableInfluxDB:!1,InfluxDBAddress:"",InfluxDBOrganizationId:"",InfluxDBBucketName:"",InfluxDBMeasurement:"",InfluxDBAccessToken:""})):this.project={DataStorage:{EnableInfluxDB:!1,InfluxDBAddress:"",InfluxDBOrganizationId:"",InfluxDBBucketName:"",InfluxDBMeasurement:"",InfluxDBAccessToken:""}},this.form=this.fb.group({EnableInfluxDB:[this.project.DataStorage.EnableInfluxDB,[]],InfluxDBAddress:[this.project.DataStorage.InfluxDBAddress,[]],InfluxDBOrganizationId:[this.project.DataStorage.InfluxDBOrganizationId,[]],InfluxDBBucketName:[this.project.DataStorage.InfluxDBBucketName,[]],InfluxDBMeasurement:[this.project.DataStorage.InfluxDBMeasurement,[]],InfluxDBAccessToken:[this.project.DataStorage.InfluxDBAccessToken,[]]})):e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.loading=!1,this.cdr.detectChanges()})}submit(){if(this.form.value.EnableInfluxDB&&(this.form.value.InfluxDBAddress==""||this.form.value.InfluxDBOrganizationId==""||this.form.value.InfluxDBBucketName==""||this.form.value.InfluxDBMeasurement==""||this.form.value.InfluxDBAccessToken=="")){this.msg.warning("InfluxDB\u4FE1\u606F\u4E0D\u80FD\u7A7A\u3002");return}this.submitting=!0,setTimeout(()=>{this.submitting=!1,this.SaveDataStorage(),this.cdr.detectChanges()},1e3)}SaveDataStorage(){this.project!=null&&(this.loading=!0,this.project.DataStorage.EnableInfluxDB=this.form.value.EnableInfluxDB,this.project.DataStorage.InfluxDBAddress=this.form.value.InfluxDBAddress,this.project.DataStorage.InfluxDBOrganizationId=this.form.value.InfluxDBOrganizationId,this.project.DataStorage.InfluxDBBucketName=this.form.value.InfluxDBBucketName,this.project.DataStorage.InfluxDBMeasurement=this.form.value.InfluxDBMeasurement,this.project.DataStorage.InfluxDBAccessToken=this.form.value.InfluxDBAccessToken,this.http.post("controlpanel/www",{function:"UpdateProject",projectId:this.projectId,data:this.project}).subscribe(e=>{e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.msg.success("\u4FDD\u5B58\u6210\u529F"),this.loading=!1,this.cdr.detectChanges()}))}};o.\u0275fac=function(i){return new(i||o)(f(R),f(y),f(H),f(M),f(T),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-device-data-storage"]],decls:12,vars:8,consts:[[1,"py-lg"],["nz-form","","se-container","1","labelWidth","200",3,"formGroup"],["label","InfluxDB"],["formControlName","EnableInfluxDB","nzCheckedChildren","\u542F\u7528","nzUnCheckedChildren","\u4E0D\u542F\u7528"],["label","InfluxDB\u5730\u5740",4,"ngIf"],["label","InfluxDB AccessToken",4,"ngIf"],["label","InfluxDB OrganizationId",4,"ngIf"],["label","InfluxDB BucketName",4,"ngIf"],["label","InfluxDB Measurement",4,"ngIf"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["label","InfluxDB\u5730\u5740"],["nz-input","","formControlName","InfluxDBAddress","placeholder","\u8BF7\u8F93\u5165\u5DF2\u5B58\u5728\u7684InfluxDB\u5730\u5740"],["label","InfluxDB AccessToken"],["nz-input","","formControlName","InfluxDBAccessToken","placeholder","\u8BF7\u8F93\u5165\u5DF2\u5B58\u5728\u7684InfluxDB AccessToken"],["label","InfluxDB OrganizationId"],["nz-input","","formControlName","InfluxDBOrganizationId","placeholder","\u8BF7\u8F93\u5165\u5DF2\u5B58\u5728\u7684InfluxDB OrganizationId"],["label","InfluxDB BucketName"],["nz-input","","formControlName","InfluxDBBucketName","placeholder","\u8BF7\u8F93\u5165\u5DF2\u5B58\u5728\u7684InfluxDB BucketName"],["label","InfluxDB Measurement"],["nz-input","","formControlName","InfluxDBMeasurement","placeholder","\u8BF7\u8F93\u5165\u5DF2\u5B58\u5728\u7684InfluxDB Measurement\uFF0C\u6216\u8005\u7CFB\u7EDF\u76F4\u63A5\u65B0\u5EFA\u7684Measurement\u540D\u5B57"]],template:function(i,t){i&1&&(u(0,"div",0)(1,"form",1)(2,"se",2),h(3,"nz-switch",3),r(),E(4,ei,2,0,"se",4)(5,ti,2,0,"se",5)(6,ii,2,0,"se",6)(7,ni,2,0,"se",7)(8,ui,2,0,"se",8),u(9,"se")(10,"button",9),d("click",function(){return t.submit()}),m(11,"\u4FDD\u5B58"),r()()()()),i&2&&(s(1),a("formGroup",t.form),s(3),a("ngIf",t.form.value.EnableInfluxDB),s(1),a("ngIf",t.form.value.EnableInfluxDB),s(1),a("ngIf",t.form.value.EnableInfluxDB),s(1),a("ngIf",t.form.value.EnableInfluxDB),s(1),a("ngIf",t.form.value.EnableInfluxDB),s(2),a("disabled",t.form.invalid)("nzLoading",t.submitting))},dependencies:[J,P,k,j,w,V,L,$,G,x,b,N,Z,ue,O],styles:['[_nghost-%COMP%]{margin-bottom:-24px}[_nghost-%COMP%]     .ant-card{width:100%}[_nghost-%COMP%]     .ant-card-meta-content{margin-top:0}[_nghost-%COMP%]     .ant-card-meta-avatar{font-size:0}[_nghost-%COMP%]     .ant-card-actions{background:#f7f9fa}[_nghost-%COMP%]     .ant-list .ant-list-item-content-single{max-width:100%}[_nghost-%COMP%]     .card-info{margin-top:16px;margin-left:40px}[_nghost-%COMP%]     .card-info:before{display:table;content:""}[_nghost-%COMP%]     .card-info:after{display:table;clear:both;content:""}[_nghost-%COMP%]     .card-info>div{position:relative;float:left;width:50%;text-align:left}[_nghost-%COMP%]     .card-info>div p{margin:0;font-size:24px;line-height:32px}[_nghost-%COMP%]     .card-info>div p:first-child{margin-bottom:4px;color:#00000073;font-size:12px;line-height:20px}[_nghost-%COMP%]     .wan{position:relative;top:-2px;margin-left:2px;font-size:14px;font-style:normal;line-height:20px}'],changeDetection:0});let n=o;return n})();var Xe=Be(Fe());var We=Be(Fe());var Qe=()=>({standalone:!0});function ai(n,o){if(n&1){let l=B();u(0,"li",35)(1,"input",36),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.Topic=i)}),r(),u(2,"button",25),d("click",function(){let t=_(l).$implicit,c=g();return C(c.deleteTopic(t))}),m(3,"\u5220\u9664"),r()()}if(n&2){let l=o.$implicit;s(1),a("ngModel",l.Topic)("ngModelOptions",F(2,Qe))}}function li(n,o){if(n&1){let l=B();u(0,"li",35)(1,"input",36),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.Topic=i)}),r(),u(2,"input",37),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.Fields=i)}),r(),u(3,"button",25),d("click",function(){let t=_(l).$implicit,c=g();return C(c.deletePublishTopic(t))}),m(4,"\u5220\u9664"),r()()}if(n&2){let l=o.$implicit;s(1),a("ngModel",l.Topic)("ngModelOptions",F(4,Qe)),s(1),a("ngModel",l.Fields)("ngModelOptions",F(5,Qe))}}var Ht=()=>({minRows:4}),Ze=(()=>{let _MqttDeviceComponent=class _MqttDeviceComponent{constructor(n,o,l,e){this.fb=n,this.msg=o,this.modal=l,this.cdr=e,this.submitting=!1,this.subscriptionTopics=[],this.publishmentTopics=[],this.predefinedJSObject="var DataSource = {  DataSet : '',};var Console = {log : function(message){ },};var JSON = {parse : function(content){ return ''; },};var Device = {SetField : function(fieldName, fieldValue){ }, SetWrittenField : function(fieldName, fieldValue){ },GetFieldValue : function(fieldName){ return '';}}",this.nzModalData=le(me)}ngOnInit(){this.Device=this.nzModalData.Device,this.form=this.fb.group({Name:[this.Device.Name,[I.required]],Enable:[this.Device.Enable,[]],InputDataProcessMode:[this.Device.InputDataProcessMode??2,[]],Mode:[this.Device.Options.Mode,[]],Server:[this.Device.Options.Server,[I.required]],Port:[this.Device.Options.Port,[I.required]],User:[this.Device.Options.User,[I.required]],Password:[this.Device.Options.Password,[I.required]],Quality:[this.Device.Options.Quality,[]],Retained:[this.Device.Options.Retained,[]],SubscriptionResultParser:[this.Device.SubscriptionResultParser,[]],OnPublishmentParser:[this.Device.OnPublishmentParser,[]]}),this.subscriptionTopics=this.Device.SubscriptionTopics,this.publishmentTopics=this.Device.PublishmentTopics==null?[]:this.Device.PublishmentTopics}deleteTopic(n){let o=this.subscriptionTopics.findIndex(l=>l?.Id==n.Id);if(o>=0){let l=this.subscriptionTopics;l.splice(o,1),this.subscriptionTopics=l}}addTopic(){let n=We.UUID.UUID();this.subscriptionTopics.push({Id:n,Topic:""})}deletePublishTopic(n){let o=this.publishmentTopics.findIndex(l=>l?.Id==n.Id);if(o>=0){let l=this.publishmentTopics;l.splice(o,1),this.publishmentTopics=l}}addPublishTopic(){let n=We.UUID.UUID();this.publishmentTopics.push({Id:n,Topic:"",Fields:""})}destroyModal(n){this.modal.destroy(n)}verifyjs(content){try{content!=null&&content!=""&&eval(this.predefinedJSObject+content)}catch(n){return n}return null}submit(){let n=this.verifyjs(this.form.value.SubscriptionResultParser);if(n!=null){this.msg.warning(`\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C\u6709\u9519\u8BEF : ${n}`);return}if(n=this.verifyjs(this.form.value.OnPublishmentParser),n!=null){this.msg.warning(`\u53D1\u9001\u6570\u636E\u524D\u89E6\u53D1\u7684\u5904\u7406\u811A\u672C\u6709\u9519\u8BEF : ${n}`);return}this.submitting=!0,setTimeout(()=>{this.submitting=!1,this.destroyModal({Id:this.Device.Id,DeviceType:this.Device.DeviceType,Name:this.form.value.Name,Enable:this.form.value.Enable,InputDataProcessMode:this.form.value.InputDataProcessMode,Options:{Mode:this.form.value.Mode,Server:this.form.value.Server,Port:this.form.value.Port,User:this.form.value.User,Password:this.form.value.Password,Quality:this.form.value.Quality,Retained:this.form.value.Retained},SubscriptionTopics:this.subscriptionTopics.filter(o=>o.Topic!=""),SubscriptionResultParser:this.form.value.SubscriptionResultParser,PublishmentTopics:this.publishmentTopics.filter(o=>o.Topic!=""&&o.Fields!=""),OnPublishmentParser:this.form.value.OnPublishmentParser}),this.msg.success("\u4FDD\u5B58\u6210\u529F"),this.cdr.detectChanges()},1e3)}cancel(){this.destroyModal(null)}};_MqttDeviceComponent.\u0275fac=function(o){return new(o||_MqttDeviceComponent)(f(R),f(y),f(pe),f(A))},_MqttDeviceComponent.\u0275cmp=z({type:_MqttDeviceComponent,selectors:[["app-mqttdevice"]],inputs:{Device:"Device"},decls:60,vars:19,consts:[["nz-form","","se-container","1","labelWidth","200",3,"formGroup"],["label","\u540D\u79F0","error","\u7ED9\u8BE5\u8BBE\u5907\u8D77\u4E2A\u540D\u5B57","required",""],["nz-input","","formControlName","Name","placeholder","\u7ED9\u8BE5\u8BBE\u5907\u8D77\u4E2A\u540D\u5B57"],["label","\u662F\u5426\u53EF\u7528","extra","\u5F53\u8BBE\u7F6E\u6210\u4E0D\u53EF\u7528\u7684\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u6536\u96C6\u8BE5\u8BBE\u5907\u7684\u6570\u636E\u3002"],["formControlName","Enable"],["nz-radio","",3,"nzValue"],["label","\u6570\u636E\u5904\u7406\u6A21\u5F0F"],["formControlName","InputDataProcessMode"],["label","\u8BBE\u5907\u6A21\u5F0F"],["formControlName","Mode"],["nz-radio","","nzValue","Server"],["nz-radio","","nzValue","Client"],["label","\u670D\u52A1\u5730\u5740","extra",`\u5F53\u8BBE\u5907\u6A21\u5F0F\u8BBE\u7F6E\u6210\u670D\u52A1\u5668\u6A21\u5F0F\u65F6\uFF0C\u672C\u5E73\u53F0\u4F1A\u76D1\u542C\u8BE5\u670D\u52A1\u5730\u5740\u6765\u63A5\u6536\u5BA2\u6237\u7AEF\u8FDE\u63A5\uFF0C\u63A5\u6536\u5BA2\u6237\u7AEF\u6570\u636E\uFF0C\u5E76\u7528\u6765\u5411\u5BA2\u6237\u7AEF\u63A8\u9001\u6570\u636E\uFF0C
  \u5F53\u8BBE\u5907\u6A21\u5F0F\u8BBE\u7F6E\u6210\u5BA2\u6237\u7AEF\u6A21\u5F0F\u65F6\uFF0C\u672C\u5E73\u53F0\u4F1A\u4EE5\u5BA2\u6237\u7AEF\u5F62\u5F0F\u5411\u8BE5\u670D\u52A1\u5730\u5740\u5BF9\u5E94\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8FDE\u63A5\uFF0C\u63A5\u6536\u670D\u52A1\u5668\u7AEF\u6570\u636E\uFF0C\u5E76\u7528\u6765\u5411\u670D\u52A1\u5668\u7AEF\u63A8\u9001\u6570\u636E\u3002`,"error","\u7ED9\u8BE5\u8BBE\u5907\u6307\u5B9A\u670D\u52A1\u5730\u5740","required",""],["nz-input","","formControlName","Server","placeholder","\u7ED9\u8BE5\u8BBE\u5907\u6307\u5B9A\u670D\u52A1\u5730\u5740"],["label","\u7AEF\u53E3","extra","\u7AEF\u53E3\u53F7","required",""],["formControlName","Port","placeholder","\u8BF7\u8F93\u5165"],["label","\u8FDE\u63A5\u7528\u6237\u540D"],["nz-input","","formControlName","User","placeholder","\u7ED9\u8BE5\u8BBE\u5907\u6307\u5B9A\u8FDE\u63A5\u7528\u6237\u540D"],["label","\u8FDE\u63A5\u5BC6\u7801"],["nz-input","","formControlName","Password","placeholder","\u7ED9\u8BE5\u8BBE\u5907\u6307\u5B9A\u8FDE\u63A5\u5BC6\u7801"],["label","\u670D\u52A1\u8D28\u91CF\u7B49\u7EA7(QoS)"],["formControlName","Quality"],["label","\u4FDD\u7559\u6807\u5FD7(Retain)"],["formControlName","Retained","nzCheckedChildren","\u4FDD\u7559","nzUnCheckedChildren","\u4E0D\u4FDD\u7559"],["label","\u8BA2\u9605\u8BDD\u9898(Topic)","extra","\u7528\u4E8E\u63A5\u6536\u6570\u636E\u7684\u8BDD\u9898"],["nz-button","","nzType","primary",3,"click"],[2,"padding-left","0"],["style","list-style-type: none",4,"ngFor","ngForOf"],["label","\u53D1\u5E03\u8BDD\u9898(Topic)","extra","\u7528\u4E8E\u53D1\u5E03\u6570\u636E\u7684\u8BDD\u9898"],["label","\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C","extra",`\u652F\u6301\u57FA\u4E8EJavaScript\u7B97\u672F\u8BA1\u7B97\u548C\u5185\u7F6E\u5BF9\u8C61\uFF1B
  \u4F8B\u5982  Console.Log('') \u5728\u9ED1\u5C4F\u4E0A\u6253\u5370\u51FA\u6765\u5185\u5BB9\uFF1B 
  DataSource.DataSet\u662F\u63A5\u6536\u5230\u7269\u7406\u8BBE\u5907\u4E0A\u4F20\u4E0A\u6765\u7684\u6570\u636E\u5185\u5BB9\uFF0C\u5BF9\u4E8EMQTT\uFF0C\u5B83\u901A\u5E38\u662FJSON\u5B57\u7B26\u4E32\uFF1B
  Device.SetField('\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5', 'AAA') \u4FDD\u5B58\u6570\u636E\u5230\u8BE5\u865A\u62DF\u8BBE\u5907\u4E0A\uFF1BDevice.GetFieldValue('\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5') \u4ECE\u865A\u62DF\u8BBE\u5907\u4E0A\u83B7\u53D6\u5B57\u6BB5\u6570\u636E\uFF1B`,3,"optionalHelp"],["nz-input","","formControlName","SubscriptionResultParser","placeholder","\u5F53\u6709\u7269\u7406\u8BBE\u5907\u6570\u636E\u8FDB\u6765\u540E\u4F1A\u89E6\u53D1\u6267\u884C\u7684\u811A\u672C\uFF0C\u901A\u5E38\u662F\u7528\u6765\u66F4\u65B0\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5\u7684\u6570\u636E\u3002",3,"nzAutosize"],["label","\u53D1\u9001\u6570\u636E\u524D\u89E6\u53D1\u7684\u5904\u7406\u811A\u672C","extra",`\u652F\u6301\u57FA\u4E8EJavaScript\u7B97\u672F\u8BA1\u7B97\u548C\u5185\u7F6E\u5BF9\u8C61\uFF1B
  \u4F8B\u5982  Console.Log('') \u5728\u9ED1\u5C4F\u4E0A\u6253\u5370\u51FA\u6765\u5185\u5BB9\uFF1B 
  Device.SetField('\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5', 'AAA') \u4FDD\u5B58\u6570\u636E\u5230\u8BE5\u865A\u62DF\u8BBE\u5907\u4E0A\uFF1BDevice.GetFieldValue('\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5') \u4ECE\u865A\u62DF\u8BBE\u5907\u4E0A\u83B7\u53D6\u5B57\u6BB5\u6570\u636E\uFF1B
  Device.SetWrittenField('DeviceId', '1234567890') \u7528\u6765\u4FEE\u6539\u5373\u5C06\u53D1\u9001\u5230\u7269\u7406\u8BBE\u5907\u7684\u6570\u636E\u5185\u5BB9\uFF0C\u4F8B\u5982\u52A0\u5165\u8BBE\u5907\u6807\u8BC6\uFF1B`,3,"optionalHelp"],["nz-input","","formControlName","OnPublishmentParser","placeholder","\u5F53\u6709\u5411\u7269\u7406\u8BBE\u5907\u53D1\u9001\u6570\u636E\u524D\u89E6\u53D1\u6267\u884C\u7684\u811A\u672C\uFF0C\u901A\u5E38\u662F\u7528\u6765\u66F4\u6539\u5411\u7269\u7406\u8BBE\u5907\u53D1\u9001\u7684\u6570\u636E\uFF0C\u4F8B\u5982\u52A0\u5165\u8BBE\u5907\u6807\u8BC6\uFF1ADevice.SetWrittenField('DeviceId', '1234567890')\uFF1B",3,"nzAutosize"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["nz-button","",1,"ml-sm",3,"click"],[2,"list-style-type","none"],["placeholder","\u6307\u5B9A\u8BDD\u9898(Topic)\u5B57\u7B26\u4E32",2,"margin-right","10px",3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","\u6307\u5B9A\u5B57\u6BB5\u540D\u5B57\uFF0C\u7528\u9017\u53F7\u8FDE\u63A5\u591A\u4E2A\u5B57\u6BB5",2,"width","300px","margin-right","10px",3,"ngModel","ngModelOptions","ngModelChange"]],template:function(o,l){o&1&&(u(0,"form",0)(1,"se",1),h(2,"input",2),r(),u(3,"se",3)(4,"nz-radio-group",4)(5,"label",5),m(6,"\u53EF\u7528"),r(),u(7,"label",5),m(8,"\u4E0D\u53EF\u7528"),r()()(),u(9,"se",6)(10,"nz-radio-group",7)(11,"label",5),m(12,"\u7B80\u5355\u5904\u7406\uFF1A\u81EA\u52A8\u628A\u63A5\u6536\u7684\u6570\u636E\u8F6C\u6210\u8BBE\u5907\u5B57\u6BB5\uFF0C\u4E0D\u9700\u8981\u5199\u300A\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C\u300B\u3002"),r(),u(13,"label",5),m(14,"\u811A\u672C\u5904\u7406\uFF1A\u4EE5\u6267\u884C\u811A\u672C\u7684\u65B9\u5F0F\u628A\u63A5\u6536\u7684\u6570\u636E\u8F6C\u6210\u8BBE\u5907\u5B57\u6BB5\uFF0C\u9700\u8981\u5199\u300A\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C\u300B\u3002"),r(),u(15,"label",5),m(16,"\u7EC4\u5408\u5904\u7406\uFF1A\u5148\u6267\u884C\u7B80\u5355\u5904\u7406\uFF0C\u518D\u6267\u884C\u811A\u672C\u5904\u7406"),r()()(),u(17,"se",8)(18,"nz-radio-group",9)(19,"label",10),m(20,"\u670D\u52A1\u5668\u6A21\u5F0F"),r(),u(21,"label",11),m(22,"\u5BA2\u6237\u7AEF\u6A21\u5F0F"),r()()(),u(23,"se",12),h(24,"input",13),r(),u(25,"se",14),h(26,"nz-input-number",15),r(),u(27,"se",16),h(28,"input",17),r(),u(29,"se",18),h(30,"input",19),r(),u(31,"se",20)(32,"nz-radio-group",21)(33,"label",5),m(34,"\u6700\u591A\u53D1\u9001\u4E00\u6B21. (\u53D1\u9001\u4E00\u6B21\u5B8C\u4E8B) "),r(),u(35,"label",5),m(36,"\u6700\u5C11\u53D1\u9001\u4E00\u6B21. (\u53EF\u80FD\u53D1\u9001\u591A\u6B21,\u5FC5\u987B\u63A5\u5230\u5E94\u7B54)"),r(),u(37,"label",5),m(38,"\u53EF\u9760\u53D1\u9001\u4E00\u6B21. (\u53EA\u53D1\u9001\u4E00\u6B21, \u5E76\u4FDD\u8BC1\u9001\u8FBE)"),r()()(),u(39,"se",22),h(40,"nz-switch",23),r(),u(41,"se",24)(42,"button",25),d("click",function(){return l.addTopic()}),m(43,"\u589E\u52A0\u8BDD\u9898"),r(),u(44,"ul",26),E(45,ai,4,3,"li",27),r()(),u(46,"se",28)(47,"button",25),d("click",function(){return l.addPublishTopic()}),m(48,"\u589E\u52A0\u8BDD\u9898"),r(),u(49,"ul",26),E(50,li,5,6,"li",27),r()(),u(51,"se",29),h(52,"textarea",30),r(),u(53,"se",31),h(54,"textarea",32),r(),u(55,"se")(56,"button",33),d("click",function(){return l.submit()}),m(57,"\u4FDD\u5B58"),r(),u(58,"button",34),d("click",function(){return l.cancel()}),m(59,"\u53D6\u6D88"),r()()()),o&2&&(a("formGroup",l.form),s(5),a("nzValue",!0),s(2),a("nzValue",!1),s(4),a("nzValue",1),s(2),a("nzValue",2),s(2),a("nzValue",3),s(18),a("nzValue",0),s(2),a("nzValue",1),s(2),a("nzValue",2),s(8),a("ngForOf",l.subscriptionTopics),s(5),a("ngForOf",l.publishmentTopics),s(1),a("optionalHelp","\u8C03\u8BD5\u811A\u672C\uFF1A\u7B2C\u4E00\u6B65\uFF0C\u6253\u5F00\u7F51\u7AD9 http://jsrun.net/new \uFF0C \u9009\u62E9 <JS\u6D3B\u9875>\u3002 \u7B2C\u4E8C\u6B65 \uFF1A\u62F7\u8D1D\u4EE5\u4E0B\u811A\u672C\u5230<JS\u6D3B\u9875>\u9876\u7AEF\u3002    "+l.predefinedJSObject+"    \u7B2C\u4E09\u6B65 \u5728\u62F7\u8D1D\u5230<JS\u6D3B\u9875>\u7684\u811A\u672C\u7684\u4E0B\u9762\u7EE7\u7EED\u7F16\u5199\u81EA\u5DF1\u7684\u811A\u672C\uFF0C\u70B9<\u8FD0\u884C>\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u4FDD\u811A\u672C\u4E0D\u51FA\u9519\u3002 \u7B2C\u56DB\u6B65  \u62F7\u8D1D\u56DE\u81EA\u5DF1\u7F16\u5199\u7684\u811A\u672C\u5230\u5E73\u53F0\u4E0A\u5BF9\u5E94\u7684\u4F4D\u7F6E\u3002"),s(1),a("nzAutosize",F(17,Ht)),s(1),a("optionalHelp","\u8C03\u8BD5\u811A\u672C\uFF1A\u7B2C\u4E00\u6B65\uFF0C\u6253\u5F00\u7F51\u7AD9 http://jsrun.net/new \uFF0C \u9009\u62E9 <JS\u6D3B\u9875>\u3002 \u7B2C\u4E8C\u6B65 \uFF1A\u62F7\u8D1D\u4EE5\u4E0B\u811A\u672C\u5230<JS\u6D3B\u9875>\u9876\u7AEF\u3002    "+l.predefinedJSObject+"    \u7B2C\u4E09\u6B65 \u5728\u62F7\u8D1D\u5230<JS\u6D3B\u9875>\u7684\u811A\u672C\u7684\u4E0B\u9762\u7EE7\u7EED\u7F16\u5199\u81EA\u5DF1\u7684\u811A\u672C\uFF0C\u70B9<\u8FD0\u884C>\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u4FDD\u811A\u672C\u4E0D\u51FA\u9519\u3002 \u7B2C\u56DB\u6B65  \u62F7\u8D1D\u56DE\u81EA\u5DF1\u7F16\u5199\u7684\u811A\u672C\u5230\u5E73\u53F0\u4E0A\u5BF9\u5E94\u7684\u4F4D\u7F6E\u3002"),s(1),a("nzAutosize",F(18,Ht)),s(2),a("disabled",l.form.invalid)("nzLoading",l.submitting))},dependencies:[te,P,k,j,w,de,V,L,$,G,x,b,N,Z,ne,ye,ue,Q,W,O],encapsulation:2,changeDetection:0});let MqttDeviceComponent=_MqttDeviceComponent;return MqttDeviceComponent})();var si=()=>({minRows:4}),Ke=(()=>{let o=class o{constructor(e,i,t,c){this.fb=e,this.msg=i,this.modal=t,this.cdr=c,this.submitting=!1,this.predefinedJSObject="var DataSource = {  DataSet : '',};var Console = {log : function(message){ },};var JSON = {parse : function(content){ return ''; },};var Device = {SetField : function(fieldName, fieldValue){ }, SetWrittenField : function(fieldName, fieldValue){ },GetFieldValue : function(fieldName){ return '';}}",this.nzModalData=le(me)}ngOnInit(){this.Device=this.nzModalData.Device,this.form=this.fb.group({Name:[this.Device.Name,[I.required]],Enable:[this.Device.Enable,[]],InputDataProcessMode:[this.Device.InputDataProcessMode,[]],GenerateBoolData:[this.Device.Options.GenerateBoolData,[]],GenerateIntData:[this.Device.Options.GenerateIntData,[]],GenerateStringData:[this.Device.Options.GenerateStringData,[]],DataInstanceNumber:[this.Device.Options.DataInstanceNumber,[I.min(1)]],TimerInterval:[this.Device.Options.TimerInterval,[I.min(100)]],MinInteger:[this.Device.Options.MinInteger,[]],MaxInteger:[this.Device.Options.MaxInteger,[]],IntegerStep:[this.Device.Options.IntegerStep,[I.min(1)]],ResultParser:[this.Device.ResultParser,[]]})}destroyModal(e){this.modal.destroy(e)}submit(){this.submitting=!0,setTimeout(()=>{this.submitting=!1,this.destroyModal({Id:this.Device.Id,DeviceType:this.Device.DeviceType,Name:this.form.value.Name,Enable:this.form.value.Enable,InputDataProcessMode:this.form.value.InputDataProcessMode,Options:{GenerateBoolData:this.form.value.GenerateBoolData,GenerateIntData:this.form.value.GenerateIntData,GenerateStringData:this.form.value.GenerateStringData,DataInstanceNumber:this.form.value.DataInstanceNumber,TimerInterval:this.form.value.TimerInterval,MinInteger:this.form.value.MinInteger,MaxInteger:this.form.value.MaxInteger,IntegerStep:this.form.value.IntegerStep},ResultParser:this.form.value.ResultParser}),this.msg.success("\u4FDD\u5B58\u6210\u529F"),this.cdr.detectChanges()},1e3)}cancel(){this.destroyModal(null)}};o.\u0275fac=function(i){return new(i||o)(f(R),f(y),f(pe),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-simulater"]],inputs:{Device:"Device"},decls:40,vars:11,consts:[["nz-form","","se-container","1","labelWidth","200",3,"formGroup"],["label","\u540D\u79F0","error","\u7ED9\u8BE5\u8BBE\u5907\u8D77\u4E2A\u540D\u5B57","required",""],["nz-input","","formControlName","Name","placeholder","\u7ED9\u8BE5\u8BBE\u5907\u8D77\u4E2A\u540D\u5B57"],["label","\u662F\u5426\u53EF\u7528","extra","\u5F53\u8BBE\u7F6E\u6210\u4E0D\u53EF\u7528\u7684\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u6536\u96C6\u8BE5\u8BBE\u5907\u7684\u6570\u636E\u3002"],["formControlName","Enable"],["nz-radio","",3,"nzValue"],["label","\u6570\u636E\u5904\u7406\u6A21\u5F0F"],["formControlName","InputDataProcessMode"],["label","\u662F\u5426\u4EA7\u751F\u5E03\u5C14\u578B\u6A21\u62DF\u6570\u636E"],["formControlName","GenerateBoolData","nzCheckedChildren","\u4EA7\u751F","nzUnCheckedChildren","\u4E0D\u4EA7\u751F"],["label","\u662F\u5426\u4EA7\u751F\u6574\u6570\u578B\u6A21\u62DF\u6570\u636E"],["formControlName","GenerateIntData","nzCheckedChildren","\u4EA7\u751F","nzUnCheckedChildren","\u4E0D\u4EA7\u751F"],["label","\u662F\u5426\u4EA7\u751F\u5B57\u7B26\u4E32\u578B\u6A21\u62DF\u6570\u636E"],["formControlName","GenerateStringData","nzCheckedChildren","\u4EA7\u751F","nzUnCheckedChildren","\u4E0D\u4EA7\u751F"],["label","\u4EA7\u751F\u6570\u636E\u5B9E\u4F8B\u7684\u4E2A\u6570","extra","\u6A21\u62DF\u51FA\u6BCF\u79CD\u7C7B\u578B\u6570\u636E\u7684\u4E2A\u6570"],["formControlName","DataInstanceNumber","placeholder","\u8BF7\u8F93\u5165"],["label","\u6570\u636E\u4EA7\u751F\u7684\u5468\u671F","extra","\u4EA7\u751F\u6A21\u62DF\u6570\u636E\u7684\u95F4\u9699\u65F6\u95F4"],["formControlName","TimerInterval","placeholder","\u8BF7\u8F93\u5165"],["label","\u4EA7\u751F\u6B65\u957F\u6574\u6570\u7684\u6700\u5C0F\u503C"],["formControlName","MinInteger","placeholder","\u8BF7\u8F93\u5165"],["label","\u4EA7\u751F\u6B65\u957F\u6574\u6570\u7684\u6700\u5927\u503C"],["formControlName","MaxInteger","placeholder","\u8BF7\u8F93\u5165"],["label","\u6B65\u957F"],["formControlName","IntegerStep","placeholder","\u8BF7\u8F93\u5165"],["label","\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C","extra",`\u652F\u6301\u57FA\u4E8EJavaScript\u7B97\u672F\u8BA1\u7B97\u548C\u5185\u7F6E\u5BF9\u8C61\uFF1B
    \u4F8B\u5982  Console.Log('') \u5728\u9ED1\u5C4F\u4E0A\u6253\u5370\u51FA\u6765\u5185\u5BB9\uFF1B 
    DataSource.DataSet\u662F\u63A5\u6536\u5230\u7269\u7406\u8BBE\u5907\u4E0A\u4F20\u4E0A\u6765\u7684\u6570\u636E\u5185\u5BB9\uFF1B
    Device.SetField('\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5', Temprature1) \u4FDD\u5B58\u6570\u636E\u5230\u8BE5\u865A\u62DF\u8BBE\u5907\u4E0A\uFF1B`,3,"optionalHelp"],["nz-input","","formControlName","ResultParser","placeholder","\u5F53\u6709\u7269\u7406\u8BBE\u5907\u6570\u636E\u8FDB\u6765\u540E\u4F1A\u89E6\u53D1\u6267\u884C\u7684\u811A\u672C\uFF0C\u901A\u5E38\u662F\u7528\u6765\u66F4\u65B0\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5\u7684\u6570\u636E\u3002",3,"nzAutosize"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["nz-button","",1,"ml-sm",3,"click"]],template:function(i,t){i&1&&(u(0,"form",0)(1,"se",1),h(2,"input",2),r(),u(3,"se",3)(4,"nz-radio-group",4)(5,"label",5),m(6,"\u53EF\u7528"),r(),u(7,"label",5),m(8,"\u4E0D\u53EF\u7528"),r()()(),u(9,"se",6)(10,"nz-radio-group",7)(11,"label",5),m(12,"\u7B80\u5355\u5904\u7406\uFF1A\u81EA\u52A8\u628A\u63A5\u6536\u7684\u6570\u636E\u8F6C\u6210\u8BBE\u5907\u5B57\u6BB5\uFF0C\u4E0D\u9700\u8981\u5199\u300A\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C\u300B\u3002"),r(),u(13,"label",5),m(14,"\u811A\u672C\u5904\u7406\uFF1A\u4EE5\u6267\u884C\u811A\u672C\u7684\u65B9\u5F0F\u628A\u63A5\u6536\u7684\u6570\u636E\u8F6C\u6210\u8BBE\u5907\u5B57\u6BB5\uFF0C\u9700\u8981\u5199\u300A\u63A5\u6536\u5230\u6570\u636E\u540E\u89E6\u53D1\u7684\u811A\u672C\u300B\u3002"),r(),u(15,"label",5),m(16,"\u7EC4\u5408\u5904\u7406\uFF1A\u5148\u6267\u884C\u7B80\u5355\u5904\u7406\uFF0C\u518D\u6267\u884C\u811A\u672C\u5904\u7406"),r()()(),u(17,"se",8),h(18,"nz-switch",9),r(),u(19,"se",10),h(20,"nz-switch",11),r(),u(21,"se",12),h(22,"nz-switch",13),r(),u(23,"se",14),h(24,"nz-input-number",15),r(),u(25,"se",16),h(26,"nz-input-number",17),r(),u(27,"se",18),h(28,"nz-input-number",19),r(),u(29,"se",20),h(30,"nz-input-number",21),r(),u(31,"se",22),h(32,"nz-input-number",23),r(),u(33,"se",24),h(34,"textarea",25),r(),u(35,"se")(36,"button",26),d("click",function(){return t.submit()}),m(37,"\u4FDD\u5B58"),r(),u(38,"button",27),d("click",function(){return t.cancel()}),m(39,"\u53D6\u6D88"),r()()()),i&2&&(a("formGroup",t.form),s(5),a("nzValue",!0),s(2),a("nzValue",!1),s(4),a("nzValue",1),s(2),a("nzValue",2),s(2),a("nzValue",3),s(18),a("optionalHelp","\u8C03\u8BD5\u811A\u672C\uFF1A\u7B2C\u4E00\u6B65\uFF0C\u6253\u5F00\u7F51\u7AD9 http://jsrun.net/new \uFF0C \u9009\u62E9 <JS\u6D3B\u9875>\u3002 \u7B2C\u4E8C\u6B65 \uFF1A\u62F7\u8D1D\u4EE5\u4E0B\u811A\u672C\u5230<JS\u6D3B\u9875>\u9876\u7AEF\u3002    "+t.predefinedJSObject+"    \u7B2C\u4E09\u6B65 \u5728\u62F7\u8D1D\u5230<JS\u6D3B\u9875>\u7684\u811A\u672C\u7684\u4E0B\u9762\u7EE7\u7EED\u7F16\u5199\u81EA\u5DF1\u7684\u811A\u672C\uFF0C\u70B9<\u8FD0\u884C>\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u4FDD\u811A\u672C\u4E0D\u51FA\u9519\u3002 \u7B2C\u56DB\u6B65  \u62F7\u8D1D\u56DE\u81EA\u5DF1\u7F16\u5199\u7684\u811A\u672C\u5230\u5E73\u53F0\u4E0A\u5BF9\u5E94\u7684\u4F4D\u7F6E\u3002"),s(1),a("nzAutosize",F(10,si)),s(2),a("disabled",t.form.invalid)("nzLoading",t.submitting))},dependencies:[P,k,j,w,V,L,$,G,x,b,N,Z,ne,ye,ue,Q,W,O],encapsulation:2,changeDetection:0});let n=o;return n})();function pi(n,o){if(n&1){let l=B();u(0,"i",13),d("click",function(){_(l);let i=g().$implicit,t=g();return C(t.EditDevice(i))}),r()}}function di(n,o){if(n&1){let l=B();u(0,"i",14),d("click",function(){_(l);let i=g().$implicit,t=g();return C(t.DeleteDevice(i))}),r()}}function fi(n,o){if(n&1&&(u(0,"nz-badge",15),m(1),r()),n&2){let l=g().$implicit;a("nzStatus",l.Enable?"success":"warning"),s(1),ve(" ",l.Name," ")}}var hi=(n,o)=>[n,o];function gi(n,o){if(n&1&&(u(0,"nz-list-item")(1,"nz-card",8),E(2,pi,1,0,"ng-template",null,9,S)(4,di,1,0,"ng-template",null,10,S),u(6,"div",11)(7,"div")(8,"p"),m(9,"\u865A\u62DF\u8BBE\u5907\u540D\u79F0 "),r(),u(10,"p"),E(11,fi,2,2,"nz-badge",12),r()()()()()),n&2){let l=o.$implicit,e=v(3),i=v(5);s(1),a("nzActions",_t(2,hi,e,i)),s(10),a("ngIf",l!=null)}}var Di=()=>({gutter:24,xxl:8,xl:12,lg:12,md:12,sm:12,xs:24}),et=(()=>{let o=class o{constructor(e,i,t,c){this.activatedRouter=e,this.http=i,this.modalSrv=t,this.cdr=c,this.loading=!0,this.list=[],this.projectId="",this.project=null,this.activatedRouter.queryParams.subscribe(p=>{this.projectId=p.projectId}),this.http.post("controlpanel/www",{function:"GetProject",projectId:this.projectId}).subscribe(p=>{p.Status==200?(p.Data!=null?(this.project=p.Data,this.project.Devices==null&&(this.project.Devices=[])):(this.project={},this.project.Devices=[]),this.project!=null&&this.project.Devices!=null&&(this.list=this.project.Devices)):p.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${p.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${p.Message}`}),this.loading=!1,this.cdr.detectChanges()})}EditDevice(e){e.DeviceType==99?this.editDeviceInternal(Ke,e,"\u7F16\u8F91\u6A21\u62DF\u5668\u865A\u62DF\u8BBE\u5907"):e.DeviceType==3&&this.editDeviceInternal(Ze,e,"\u7F16\u8F91MQTT\u865A\u62DF\u8BBE\u5907")}editDeviceInternal(e,i,t){this.modalSrv.create({nzTitle:t,nzContent:e,nzFooter:null,nzWidth:1e3,nzStyle:{top:"10px"},nzData:{Device:i}}).afterClose.subscribe(p=>{if(p!=null&&p.Id!=""){let D=this.list.findIndex(q=>q?.Id==p.Id);D>=0&&(this.loading=!0,this.list.splice(D,1),this.list=this.list.concat([p]),this.SaveDevices())}})}SaveDevices(){this.project!=null&&(this.loading=!0,this.project.Devices=[],this.project.Devices=this.list,this.http.post("controlpanel/www",{function:"UpdateProject",projectId:this.projectId,data:this.project}).subscribe(e=>{e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.loading=!1,this.cdr.detectChanges()}))}AddMQTTDevice(){let e=Xe.UUID.UUID(),i={Id:e,DeviceType:3,Name:`MQTT-${e}`,Enable:!0,InputDataProcessMode:2,Options:{Mode:"Server",Server:"127.0.0.1",Port:1883,User:"test",Password:"test",Quality:0,Retained:!1},SubscriptionTopics:[{Topic:"zlanpublish"}],SubscriptionResultParser:"",PublishmentTopics:[{Topic:"zlanpublish1",Fields:"Shidu"}],OnPublishmentParser:""};this.list=this.list.concat([i]),this.SaveDevices(),this.cdr.detectChanges()}AddSimulator(){let e=Xe.UUID.UUID(),i={Id:e,DeviceType:99,Name:`Simulator-${e}`,Enable:!0,InputDataProcessMode:1,Options:{GenerateBoolData:!0,GenerateIntData:!0,GenerateStringData:!0,DataInstanceNumber:7,TimerInterval:1e3,MinInteger:0,MaxInteger:120,IntegerStep:1},ResultParser:""};this.list=this.list.concat([i]),this.SaveDevices(),this.cdr.detectChanges()}DeleteDevice(e){let i=this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u5220\u9664\u8BBE\u5907\uFF1F</i>",nzContent:e.Name,nzOnOk:()=>{let t=this.list.findIndex(c=>c?.Id==e.Id);if(t>=0){this.loading=!0;let c=this.list;c.splice(t,1),this.list=c,this.SaveDevices(),this.cdr.detectChanges(),this.loading=!1}}})}};o.\u0275fac=function(i){return new(i||o)(f(H),f(M),f(T),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-device-list"]],decls:17,vars:7,consts:[[1,"py-lg"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzType"],["nz-icon","","nzType","plus"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],[3,"nzLoading","nzDataSource","nzRenderItem","nzGrid"],["item",""],["nzHoverable","",3,"nzActions"],["op2",""],["op3",""],[1,"card-info","d-flex"],[3,"nzStatus",4,"ngIf"],["nz-tooltip","","nzTooltipTitle","\u7F16\u8F91","nz-icon","","nzType","edit",3,"click"],["nz-tooltip","","nzTooltipTitle","\u5220\u9664","nz-icon","","nzType","delete",3,"click"],[3,"nzStatus"]],template:function(i,t){if(i&1&&(u(0,"div",0)(1,"button",1),h(2,"i",2),u(3,"span"),m(4,"\u65B0\u5EFA\u865A\u62DF\u8BBE\u5907"),r()(),u(5,"nz-dropdown-menu",null,3)(7,"ul",4)(8,"li",5),d("click",function(){return t.AddMQTTDevice()}),u(9,"a"),m(10,"MQTT"),r()(),u(11,"li",5),d("click",function(){return t.AddSimulator()}),u(12,"a"),m(13,"\u6D4B\u8BD5\u8BBE\u5907\u6A21\u62DF\u5668"),r()()()()(),u(14,"nz-list",6),E(15,gi,12,5,"ng-template",null,7,S),r()),i&2){let c=v(6),p=v(16);s(1),a("nzDropdownMenu",c)("nzType","primary"),s(13),a("nzLoading",t.loading)("nzDataSource",t.list)("nzRenderItem",p)("nzGrid",F(6,Di))}},dependencies:[J,x,b,N,he,fe,Ie,ge,Ne,St,xe,ie,ke,Ve,Oe,K],styles:['[_nghost-%COMP%]{margin-bottom:-24px}[_nghost-%COMP%]     .ant-card{width:100%}[_nghost-%COMP%]     .ant-card-meta-content{margin-top:0}[_nghost-%COMP%]     .ant-card-meta-avatar{font-size:0}[_nghost-%COMP%]     .ant-card-actions{background:#f7f9fa}[_nghost-%COMP%]     .ant-list .ant-list-item-content-single{max-width:100%}[_nghost-%COMP%]     .card-info{margin-top:16px;margin-left:40px}[_nghost-%COMP%]     .card-info:before{display:table;content:""}[_nghost-%COMP%]     .card-info:after{display:table;clear:both;content:""}[_nghost-%COMP%]     .card-info>div{position:relative;float:left;width:50%;text-align:left}[_nghost-%COMP%]     .card-info>div p{margin:0;font-size:24px;line-height:32px}[_nghost-%COMP%]     .card-info>div p:first-child{margin-bottom:4px;color:#00000073;font-size:12px;line-height:20px}[_nghost-%COMP%]     .wan{position:relative;top:-2px;margin-left:2px;font-size:14px;font-style:normal;line-height:20px}'],changeDetection:0});let n=o;return n})();var Zt=Be(Fe());var Ge=()=>({standalone:!0});function _i(n,o){if(n&1){let l=B();u(0,"li",10)(1,"nz-switch",11),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.Enabled=i)}),r(),m(2," \u8BBE\u5907Id: "),u(3,"input",12),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.DeviceId=i)}),r(),m(4," \u7528\u6237\u540D\uFF1A "),u(5,"input",13),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.UserName=i)}),r(),m(6," \u5BC6\u7801\uFF1A "),u(7,"input",14),d("ngModelChange",function(i){let c=_(l).$implicit;return C(c.Password=i)}),r(),u(8,"button",15),d("click",function(){let t=_(l).$implicit,c=g();return C(c.deleteRule(t))}),m(9,"\u5220\u9664"),r()()}if(n&2){let l=o.$implicit;s(1),a("ngModel",l.Enabled)("ngModelOptions",F(8,Ge)),s(2),a("ngModel",l.DeviceId)("ngModelOptions",F(9,Ge)),s(2),a("ngModel",l.UserName)("ngModelOptions",F(10,Ge)),s(2),a("ngModel",l.Password)("ngModelOptions",F(11,Ge))}}var tt=(()=>{let o=class o{constructor(e,i,t,c,p,D){this.fb=e,this.msg=i,this.activatedRouter=t,this.http=c,this.modalSrv=p,this.cdr=D,this.loading=!0,this.list=[],this.projectId="",this.project=null,this.submitting=!1,this.activatedRouter.queryParams.subscribe(q=>{this.projectId=q?.projectId})}ngOnInit(){this.form=this.fb.group({EnableMode:[1,[]],Devices:[[],[]]}),this.http.post("controlpanel/www",{function:"GetProject",projectId:this.projectId}).subscribe(e=>{e.Status==200?(e.Data!=null?(this.project=e.Data,this.project.DeviceSecurity==null&&(this.project.DeviceSecurity={EnableMode:1,Devices:[]})):this.project={DeviceSecurity:{EnableMode:1,Devices:[]}},this.project!=null&&this.project.DeviceSecurity!=null&&(this.list=this.project.DeviceSecurity.Devices),this.form=this.fb.group({EnableMode:[this.project.DeviceSecurity.EnableMode,[]],Devices:[this.list,[]]})):e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.loading=!1,this.cdr.detectChanges()})}submit(){if(this.form.value.EnableMode==2){if(this.list.filter(i=>i.Enabled&&(i.DeviceId!=""||i.UserName!=""&&i.Password!="")).length==0){this.msg.warning("\u767D\u540D\u5355\u6A21\u5F0F\u4E0B\uFF0C\u81F3\u5C11\u8981\u6709\u4E00\u4E2A\u5F00\u542F\u72B6\u6001\u7684\u89C4\u5219\u662F\u6709\u8BBE\u5907Id\u6216\u8005\u4E00\u7EC4\u6709\u6548\u7684\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u5BC6\u7801\u4E0D\u80FD\u7A7A\u3002");return}}else if(this.form.value.EnableMode==3&&this.list.filter(i=>i.Enabled&&i.DeviceId!="").length==0){this.msg.warning("\u9ED1\u540D\u5355\u6A21\u5F0F\u4E0B\uFF0C\u81F3\u5C11\u8981\u6709\u4E00\u4E2A\u5F00\u542F\u72B6\u6001\u7684\u89C4\u5219\u662F\u6709\u8BBE\u5907Id\u7684\u3002");return}this.list.filter(e=>e.DeviceId!=""||e.UserName!=""),this.submitting=!0,setTimeout(()=>{this.submitting=!1,this.SaveDevices(),this.cdr.detectChanges()},1e3)}SaveDevices(){this.project!=null&&(this.loading=!0,this.project.DeviceSecurity.EnableMode=this.form.value.EnableMode,this.project.DeviceSecurity.Devices=this.list.filter(e=>e.DeviceId!=""||e.UserName!=""),this.http.post("controlpanel/www",{function:"UpdateProject",projectId:this.projectId,data:this.project}).subscribe(e=>{e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.msg.success("\u4FDD\u5B58\u6210\u529F"),this.loading=!1,this.cdr.detectChanges()}))}deleteRule(e){let i=this.list.findIndex(t=>t?.Id==e.Id);if(i>=0){let t=this.list;t.splice(i,1),this.list=t}}addRule(){let e=Zt.UUID.UUID();this.list.push({Id:e,Enabled:!0,DeviceId:"",UserName:"",Password:""})}};o.\u0275fac=function(i){return new(i||o)(f(R),f(y),f(H),f(M),f(T),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-device-security"]],decls:20,vars:7,consts:[[1,"py-lg"],["nz-form","","se-container","1","labelWidth","100",3,"formGroup"],["label","\u63A5\u5165\u6A21\u5F0F","required",""],["formControlName","EnableMode","nzSize","small"],["nz-radio","",3,"nzValue"],["label","\u89C4\u5219"],["nz-button","","nzType","primary",3,"click"],[2,"padding-left","0"],["style","list-style-type: none",4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],[2,"list-style-type","none"],["nzCheckedChildren","\u5F00\u542F","nzUnCheckedChildren","\u5173\u95ED",3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","\u6307\u5B9A\u63A5\u5165\u8BBE\u5907Id",2,"margin-right","10px",3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","\u6307\u5B9A\u63A5\u5165\u7528\u6237\u540D",2,"margin-right","10px",3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","\u6307\u5B9A\u63A5\u5165\u5BC6\u7801",2,"margin-right","10px",3,"ngModel","ngModelOptions","ngModelChange"],["nz-button","","nzSize","small",3,"click"]],template:function(i,t){i&1&&(u(0,"div",0)(1,"form",1)(2,"se",2)(3,"nz-radio-group",3)(4,"label",4),m(5,"\u505C\u6B62\u5B89\u5168\u63A7\u5236"),r(),h(6,"br"),u(7,"label",4),m(8,"\u4EE5\u767D\u540D\u5355\u5F62\u5F0F\u8FDB\u884C\u5B89\u5168\u63A5\u5165\u63A7\u5236\uFF1A\u4EC5\u5728\u4E0B\u5217\u5217\u8868\u4E2D\u7684\u8BBE\u5907\u53EF\u4EE5\u63A5\u5165\u5E73\u53F0\uFF0C\u8FD9\u79CD\u60C5\u51B5\u4E0B\u53EF\u4EE5\u662F 1. \u4EC5\u8BBE\u5907Id\uFF0C 2.\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C3.\u8BBE\u5907Id\uFF0C\u7528\u6237\u540D\u548C\u5BC6\u7801\u4E09\u8005\u540C\u65F6\u751F\u6548\u3002"),r(),h(9,"br"),u(10,"label",4),m(11,"\u4EE5\u9ED1\u540D\u5355\u5F62\u5F0F\u8FDB\u884C\u5B89\u5168\u63A5\u5165\u63A7\u5236\uFF1A\u4EC5\u5728\u4E0B\u5217\u5217\u8868\u4E2D\u7684\u8BBE\u5907\u4E0D\u53EF\u4EE5\u63A5\u5165\u5E73\u53F0\uFF0C\u4EE5\u5916\u8BBE\u5907\u90FD\u53EF\u4EE5\u63A5\u5165\uFF0C\u8FD9\u79CD\u60C5\u51B5\u4E0B\u4EC5\u4EC5\u8BBE\u5907Id\u5185\u5BB9\u6709\u6548\u3002"),r()()(),u(12,"se",5)(13,"button",6),d("click",function(){return t.addRule()}),m(14,"\u589E\u52A0\u5B89\u5168\u89C4\u5219"),r(),u(15,"ul",7),E(16,_i,10,12,"li",8),r()(),u(17,"se")(18,"button",9),d("click",function(){return t.submit()}),m(19,"\u4FDD\u5B58"),r()()()()),i&2&&(s(1),a("formGroup",t.form),s(3),a("nzValue",1),s(3),a("nzValue",2),s(3),a("nzValue",3),s(6),a("ngForOf",t.list),s(2),a("disabled",t.form.invalid)("nzLoading",t.submitting))},dependencies:[te,P,k,j,w,de,V,L,$,G,x,b,N,ue,Q,W,O],styles:['[_nghost-%COMP%]{margin-bottom:-24px}[_nghost-%COMP%]     .ant-card{width:100%}[_nghost-%COMP%]     .ant-card-meta-content{margin-top:0}[_nghost-%COMP%]     .ant-card-meta-avatar{font-size:0}[_nghost-%COMP%]     .ant-card-actions{background:#f7f9fa}[_nghost-%COMP%]     .ant-list .ant-list-item-content-single{max-width:100%}[_nghost-%COMP%]     .card-info{margin-top:16px;margin-left:40px}[_nghost-%COMP%]     .card-info:before{display:table;content:""}[_nghost-%COMP%]     .card-info:after{display:table;clear:both;content:""}[_nghost-%COMP%]     .card-info>div{position:relative;float:left;width:50%;text-align:left}[_nghost-%COMP%]     .card-info>div p{margin:0;font-size:24px;line-height:32px}[_nghost-%COMP%]     .card-info>div p:first-child{margin-bottom:4px;color:#00000073;font-size:12px;line-height:20px}[_nghost-%COMP%]     .wan{position:relative;top:-2px;margin-left:2px;font-size:14px;font-style:normal;line-height:20px}'],changeDetection:0});let n=o;return n})();var nt=Be(Fe());function Ci(n,o){n&1&&h(0,"input",21)}function Ei(n,o){n&1&&(u(0,"nz-radio-group",22)(1,"label",5),m(2,"True"),r(),u(3,"label",5),m(4,"False"),r()()),n&2&&(s(1),a("nzValue",!0),s(2),a("nzValue",!1))}function Fi(n,o){n&1&&(u(0,"se",23)(1,"nz-radio-group",24)(2,"label",5),m(3,"\u5B58\u50A8"),r(),u(4,"label",5),m(5,"\u4E0D\u5B58\u50A8"),r()()()),n&2&&(s(2),a("nzValue",!0),s(2),a("nzValue",!1))}var Bi=()=>({minRows:4}),it=(()=>{let o=class o{constructor(e,i,t){this.fb=e,this.msg=i,this.cdr=t,this.submitting=!1,this.modelNodeChange=new ft,this.predefinedJSObject="var Console = {log : function(message){ },};var JSON = {parse : function(content){ return ''; },};var DevicesProxy = {GetData : function(deviceName, fieldName){ return '';}}"}ngOnChanges(e){this.form=this.fb.group({Name:[e?.modelNode.currentValue.Name,[I.required]],DefaultValue:[e?.modelNode.currentValue.DefaultValue,[I.required]],ValueType:[e?.modelNode.currentValue.ValueType,[I.required]],IsHiden:[e?.modelNode.currentValue.IsHiden,[I.required]],IsStored:[e?.modelNode.currentValue.IsStored==null?!1:e?.modelNode.currentValue.IsStored,[I.required]],Expression:[e?.modelNode.currentValue.Expression,[]],Action:[e?.modelNode.currentValue.Action,[]],BoundDevice:[e?.modelNode.currentValue.BoundDevice,[]],BoundField:[e?.modelNode.currentValue.BoundField,[]]})}submit(){this.submitting=!0,setTimeout(()=>{this.submitting=!1;let e={Name:this.form.value.Name,DefaultValue:this.form.value.DefaultValue,ValueType:this.form.value.ValueType,IsHiden:this.form.value.IsHiden,IsStored:this.form.value.ValueType==2||this.form.value.ValueType==4?!1:this.form.value.IsStored,Expression:this.form.value.Expression,Action:this.form.value.Action,BoundDevice:this.form.value.BoundDevice,BoundField:this.form.value.BoundField};this.modelNodeChange.emit(e),this.msg.success("\u63D0\u4EA4\u6210\u529F"),this.cdr.detectChanges()},1e3)}};o.\u0275fac=function(i){return new(i||o)(f(R),f(y),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-node-form"]],inputs:{modelNode:"modelNode"},outputs:{modelNodeChange:"modelNodeChange"},features:[dt],decls:38,vars:18,consts:[["nz-form","","se-container","1",3,"formGroup","ngSubmit"],["label","\u540D\u79F0","error","\u7ED9\u8BE5\u8282\u70B9\u8D77\u4E2A\u540D\u5B57","required",""],["nz-input","","formControlName","Name","placeholder","\u7ED9\u8BE5\u8282\u70B9\u8D77\u4E2A\u540D\u5B57","maxlength","32"],["label","\u6570\u636E\u7C7B\u578B"],["formControlName","ValueType"],["nz-radio","",3,"nzValue"],["label","\u6570\u636E\u521D\u59CB\u503C"],["nz-input","","formControlName","DefaultValue","placeholder","\u521D\u59CB\u6570\u503C",4,"ngIf"],["formControlName","DefaultValue",4,"ngIf"],["label","\u662F\u5426\u53EF\u7528","extra","\u5F53\u8BBE\u7F6E\u6210\u4E0D\u53EF\u7528\u7684\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u6536\u96C6\u8BE5\u8282\u70B9\u7684\u6570\u636E\uFF0C\u5BF9\u8BE5\u8282\u70B9\u7684\u8BA2\u9605\u65E0\u6548\u3002"],["formControlName","IsHiden"],["label","\u662F\u5426\u5B58\u50A8\u6570\u636E","extra","\u5F53\u8BBE\u7F6E\u6210\u4E0D\u5B58\u50A8\u7684\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u5B58\u50A8\u8BE5\u8282\u70B9\u7684\u6570\u636E\u3002",4,"ngIf"],["label","\u8868\u8FBE\u5F0F","extra","\u652F\u6301\u57FA\u4E8EJavaScript\u7B97\u672F\u8BA1\u7B97\u548C\u5185\u7F6E\u5BF9\u8C61,\u4F8B\u5982 DevicesProxy.GetData('\u865A\u62DF\u8BBE\u5907\u540D\u79F0','\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5');\u4E5F\u53EF\u4EE5\u5F15\u7528\u5176\u4ED6\u8282\u70B9\uFF0C\u683C\u5F0F\uFF1ARoot.\u8282\u70B91.\u8282\u70B91-1.Value = 'AAA'.",3,"optionalHelp"],["nz-input","","formControlName","Expression","placeholder","\u7ED9\u8BE5\u8282\u70B9\u8BBE\u7F6E\u4E00\u4E2A\u8868\u8FBE\u5F0F\u6765\u8BA1\u7B97\u8282\u70B9\u7684\u6570\u503C\u3002"],["label","\u811A\u672C","extra","\u652F\u6301\u57FA\u4E8EJavaScript\u7B97\u672F\u8BA1\u7B97\u548C\u5185\u7F6E\u5BF9\u8C61,\u4F8B\u5982 DevicesProxy.GetData('\u865A\u62DF\u8BBE\u5907\u540D\u79F0','\u865A\u62DF\u8BBE\u5907\u5B57\u6BB5'); Console.Log('') \u5728\u9ED1\u5C4F\u4E0A\u6253\u5370\u51FA\u6765\u5185\u5BB9\uFF1B \u4E5F\u53EF\u4EE5\u5F15\u7528\u5176\u4ED6\u8282\u70B9\uFF0C\u683C\u5F0F\uFF1ARoot.\u8282\u70B91.\u8282\u70B91-1.Value = 'AAA'. ",3,"optionalHelp"],["nz-input","","formControlName","Action","placeholder","\u5F53\u8BE5\u8282\u70B9\u7684\u6570\u503C\u53D8\u5316\u540E\u4F1A\u6267\u884C\u7684\u811A\u672C\uFF0C\u901A\u5E38\u662F\u6765\u89E6\u53D1\u5173\u8054\u8282\u70B9\u7684\u6570\u636E\u66F4\u65B0\u3002",3,"nzAutosize"],["label","\u56DE\u5199\u8BBE\u5907\u540D\u79F0"],["nz-input","","formControlName","BoundDevice","placeholder","\u7528\u4E8E\u7ED1\u5B9A\u5230\u5BF9\u5E94\u7684\u56DE\u5199\u8BBE\u5907\uFF0C\u8BBE\u5907\u540D\u79F0\u662F\u865A\u62DF\u8BBE\u5907\u540D\u79F0\u3002"],["label","\u56DE\u5199\u5B57\u6BB5\u540D\u79F0"],["nz-input","","formControlName","BoundField","placeholder","\u7528\u4E8E\u7ED1\u5B9A\u5230\u5BF9\u5E94\u7684\u56DE\u5199\u5B57\u6BB5\uFF0C\u5B57\u6BB5\u662F\u865A\u62DF\u8BBE\u5907\u4E0A\u7684\u5B57\u6BB5\u3002"],["nz-button","","nzType","primary","type","submit",3,"disabled","nzLoading"],["nz-input","","formControlName","DefaultValue","placeholder","\u521D\u59CB\u6570\u503C"],["formControlName","DefaultValue"],["label","\u662F\u5426\u5B58\u50A8\u6570\u636E","extra","\u5F53\u8BBE\u7F6E\u6210\u4E0D\u5B58\u50A8\u7684\u7684\u65F6\u5019\uFF0C\u7CFB\u7EDF\u4E0D\u4F1A\u5B58\u50A8\u8BE5\u8282\u70B9\u7684\u6570\u636E\u3002"],["formControlName","IsStored"]],template:function(i,t){i&1&&(u(0,"form",0),d("ngSubmit",function(){return t.submit()}),u(1,"se",1),h(2,"input",2),r(),u(3,"se",3)(4,"nz-radio-group",4)(5,"label",5),m(6,"\u6574\u6570"),r(),u(7,"label",5),m(8,"\u5B57\u7B26\u4E32"),r(),u(9,"label",5),m(10,"\u5E03\u5C14"),r(),u(11,"label",5),m(12,"\u65E5\u671F\u65F6\u95F4"),r(),u(13,"label",5),m(14,"\u5355\u7CBE\u5EA6"),r(),u(15,"label",5),m(16,"\u53CC\u7CBE\u5EA6"),r()()(),u(17,"se",6),E(18,Ci,1,0,"input",7)(19,Ei,5,2,"nz-radio-group",8),r(),u(20,"se",9)(21,"nz-radio-group",10)(22,"label",5),m(23,"\u53EF\u7528"),r(),u(24,"label",5),m(25,"\u4E0D\u53EF\u7528"),r()()(),E(26,Fi,6,2,"se",11),u(27,"se",12),h(28,"input",13),r(),u(29,"se",14),h(30,"textarea",15),r(),u(31,"se",16),h(32,"input",17),r(),u(33,"se",18),h(34,"input",19),r(),u(35,"se")(36,"button",20),m(37,"\u4FDD\u5B58"),r()()()),i&2&&(a("formGroup",t.form),s(5),a("nzValue",1),s(2),a("nzValue",2),s(2),a("nzValue",3),s(2),a("nzValue",4),s(2),a("nzValue",5),s(2),a("nzValue",6),s(3),a("ngIf",t.form.value.ValueType!==3),s(1),a("ngIf",t.form.value.ValueType===3),s(3),a("nzValue",!1),s(2),a("nzValue",!0),s(2),a("ngIf",t.form.value.ValueType!==2&&t.form.value.ValueType!==4),s(1),a("optionalHelp","\u8C03\u8BD5\u811A\u672C\uFF1A\u7B2C\u4E00\u6B65\uFF0C\u6253\u5F00\u7F51\u7AD9 http://jsrun.net/new \uFF0C \u9009\u62E9 <JS\u6D3B\u9875>\u3002 \u7B2C\u4E8C\u6B65 \uFF1A\u62F7\u8D1D\u4EE5\u4E0B\u811A\u672C\u5230<JS\u6D3B\u9875>\u9876\u7AEF\u3002    "+t.predefinedJSObject+"    \u7B2C\u4E09\u6B65 \u5728\u62F7\u8D1D\u5230<JS\u6D3B\u9875>\u7684\u811A\u672C\u7684\u4E0B\u9762\u7EE7\u7EED\u7F16\u5199\u81EA\u5DF1\u7684\u811A\u672C\uFF0C\u70B9<\u8FD0\u884C>\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u4FDD\u811A\u672C\u4E0D\u51FA\u9519\u3002 \u7B2C\u56DB\u6B65  \u62F7\u8D1D\u56DE\u81EA\u5DF1\u7F16\u5199\u7684\u811A\u672C\u5230\u5E73\u53F0\u4E0A\u5BF9\u5E94\u7684\u4F4D\u7F6E\u3002"),s(2),a("optionalHelp","\u8C03\u8BD5\u811A\u672C\uFF1A\u7B2C\u4E00\u6B65\uFF0C\u6253\u5F00\u7F51\u7AD9 http://jsrun.net/new \uFF0C \u9009\u62E9 <JS\u6D3B\u9875>\u3002 \u7B2C\u4E8C\u6B65 \uFF1A\u62F7\u8D1D\u4EE5\u4E0B\u811A\u672C\u5230<JS\u6D3B\u9875>\u9876\u7AEF\u3002    "+t.predefinedJSObject+"    \u7B2C\u4E09\u6B65 \u5728\u62F7\u8D1D\u5230<JS\u6D3B\u9875>\u7684\u811A\u672C\u7684\u4E0B\u9762\u7EE7\u7EED\u7F16\u5199\u81EA\u5DF1\u7684\u811A\u672C\uFF0C\u70B9<\u8FD0\u884C>\u6D4B\u8BD5\u811A\u672C\uFF0C\u786E\u4FDD\u811A\u672C\u4E0D\u51FA\u9519\u3002 \u7B2C\u56DB\u6B65  \u62F7\u8D1D\u56DE\u81EA\u5DF1\u7F16\u5199\u7684\u811A\u672C\u5230\u5E73\u53F0\u4E0A\u5BF9\u5E94\u7684\u4F4D\u7F6E\u3002"),s(1),a("nzAutosize",F(17,Bi)),s(6),a("disabled",t.form.invalid)("nzLoading",t.submitting))},dependencies:[J,P,k,j,w,bt,V,L,$,G,x,b,N,Z,ne,Q,W,O],encapsulation:2,changeDetection:0});let n=o;return n})();function Ai(n,o){if(n&1&&h(0,"nz-badge",14),n&2){let l=g().$implicit;a("nzStatus",l.origin.modelNode.IsHiden?"warning":"success")}}function bi(n,o){if(n&1){let l=B();u(0,"li",12),d("click",function(){_(l);let i=g().$implicit,t=g();return C(t.copyPasteAddNewSubNode(i))}),m(1,"\u590D\u5236\u8282\u70B9\u521B\u5EFA\u5B50\u8282\u70B9"),r()}}function Si(n,o){if(n&1){let l=B();u(0,"li",12),d("click",function(){_(l);let i=g().$implicit,t=g();return C(t.copyPasteAddNewBrotherNode(i))}),m(1,"\u590D\u5236\u8282\u70B9\u521B\u5EFA\u5144\u5F1F\u8282\u70B9"),r()}}function xi(n,o){if(n&1){let l=B();u(0,"li",12),d("click",function(){_(l);let i=g().$implicit,t=g();return C(t.deleteNode(i))}),m(1,"\u5220\u9664"),r()}}function Ii(n,o){if(n&1){let l=B();u(0,"span",6)(1,"span",7),d("contextmenu",function(i){_(l);let t=v(6),c=g();return C(c.contextMenu(i,t))}),u(2,"span",8),m(3),r(),E(4,Ai,1,1,"nz-badge",9),r()(),u(5,"nz-dropdown-menu",null,10)(7,"ul",11)(8,"li",12),d("click",function(){let t=_(l).$implicit,c=g();return C(c.addNewNode(t))}),m(9,"\u65B0\u589E\u5B50\u8282\u70B9"),r(),E(10,bi,2,0,"li",13)(11,Si,2,0,"li",13)(12,xi,2,0,"li",13),r()()}if(n&2){let l=o.$implicit;s(3),se(l.title),s(1),a("ngIf",l.origin.modelNode!=null),s(6),a("ngIf",l.parentNode!=null),s(1),a("ngIf",l.parentNode!=null),s(1),a("ngIf",l.parentNode!=null)}}function Ni(n,o){if(n&1){let l=B();u(0,"app-node-form",15),d("modelNodeChange",function(i){_(l);let t=g();return C(t.updateModelHandler(i))}),r()}if(n&2){let l=g();a("modelNode",l.selectedModelNode)}}var ut=(()=>{let o=class o{nzEvent(e){console.log(e)}constructor(e,i,t,c,p){this.activatedRouter=e,this.http=i,this.modalSrv=t,this.cdr=c,this.nzContextMenuService=p,this.projectId="",this.loading=!0,this.project=null,this.defaultModelNode={Name:"NewNode",DefaultValue:0,ValueType:1,IsHiden:!1,IsStored:!1,Expression:"",Action:"",BoundDevice:"",BoundField:""},this.activatedRouter.queryParams.subscribe(D=>{this.projectId=D?.projectId}),this.loading=!0,this.http.post("controlpanel/www",{function:"GetProject",projectId:this.projectId}).pipe(mt(()=>{this.loading=!1,this.cdr.detectChanges()})).subscribe(D=>{if(D.Status==200){if(D.Data==null?(this.project={},this.project.Nodes=[]):(this.project=D.Data,this.project.Nodes==null&&(this.project.Nodes=[])),this.project!=null&&this.project.Nodes!=null){let q=[{title:"\u5E94\u7528\u6A21\u578B",key:"100",expanded:!0,children:[]}];this.LoadNodeTree(q[0].children,this.project.Nodes),this.nodes=q}}else D.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${D.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${D.Message}`})})}SaveNodeTree(){this.project!=null&&(this.loading=!0,this.project.Nodes=[],this.UpdateNodeTree(this.nodes[0].children,this.project.Nodes),this.http.post("controlpanel/www",{function:"UpdateProject",projectId:this.projectId,data:this.project}).subscribe(e=>{e.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`}),this.loading=!1,this.cdr.detectChanges()}))}LoadNodeTree(e,i){i.forEach(t=>{let c=t.Nodes==null||t.Nodes.length==0,p={title:t.Name,key:nt.UUID.UUID(),modelNode:t,expanded:!c,isLeaf:c,children:[]};c||this.LoadNodeTree(p.children,t.Nodes),t.Nodes=[],e.push(p)})}UpdateNodeTree(e,i){e.forEach(t=>{let c=JSON.parse(JSON.stringify(t.modelNode));i.push(c),t.children&&(c.Nodes=[],this.UpdateNodeTree(t.children,c.Nodes))})}clickOnNode(e){this.selectedTreeNode=e.node,this.selectedModelNode=e.node?.origin?.modelNode}contextMenu(e,i){this.nzContextMenuService.create(e,i)}copyPasteAddNewSubNode(e){e.origin?.modelNode!=null&&this.addNewNodeInternel(e,e.origin?.modelNode)}copyPasteAddNewBrotherNode(e){let i=e.getParentNode();i!=null&&e.origin?.modelNode!=null&&this.addNewNodeInternel(i,e.origin?.modelNode)}addNewNode(e){this.addNewNodeInternel(e,this.defaultModelNode)}addNewNodeInternel(e,i){e.isLeaf&&(e.isLeaf=!1);let t=JSON.parse(JSON.stringify(i));t.Nodes=[],e.addChildren([{title:i.Name,key:nt.UUID.UUID(),modelNode:t,isLeaf:!0}]),e.isExpanded||(e.isExpanded=!0),this.SaveNodeTree()}updateModelHandler(e){this.selectedTreeNode!=null&&(this.selectedTreeNode.origin.modelNode=e,this.selectedTreeNode.title!=e.Name&&(this.selectedTreeNode.title=e.Name),this.SaveNodeTree())}deleteNode(e){this.selectedTreeNode!=null&&this.selectedTreeNode.key==e.key&&(this.selectedTreeNode=void 0,this.selectedModelNode=null),e.isLeaf&&e.parentNode!=null&&(e.parentNode.isLeaf=!0),e.remove(),this.SaveNodeTree()}dclickOnNode(e){if(e instanceof kt)e.isExpanded=!e.isExpanded;else{let i=e.node;i&&(i.isExpanded=!i.isExpanded)}}};o.\u0275fac=function(i){return new(i||o)(f(H),f(M),f(T),f(A),f(It))},o.\u0275cmp=z({type:o,selectors:[["app-model-tree"]],decls:7,vars:3,consts:[["nz-row","",1,"py-lg"],["nz-col","","nzMd","6","nzLg","6",2,"height","800px","overflow","auto"],["nzShowLine","",3,"nzData","nzTreeTemplate","nzClick","nzDblClick"],["nzTreeTemplate",""],["nz-col","","nzMd","16","nzLg","16"],[3,"modelNode","modelNodeChange",4,"ngIf"],[1,"custom-node"],[3,"contextmenu"],[1,"file-name"],[3,"nzStatus",4,"ngIf"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"click",4,"ngIf"],[3,"nzStatus"],[3,"modelNode","modelNodeChange"]],template:function(i,t){if(i&1&&(u(0,"div",0)(1,"div",1)(2,"nz-tree",2),d("nzClick",function(p){return t.clickOnNode(p)})("nzDblClick",function(p){return t.dclickOnNode(p)}),r(),E(3,Ii,13,5,"ng-template",null,3,S),r(),u(5,"div",4),E(6,Ni,1,1,"app-node-form",5),r()()),i&2){let c=v(4);s(2),a("nzData",t.nodes)("nzTreeTemplate",c),s(4),a("ngIf",t.selectedModelNode!=null)}},dependencies:[J,b,he,fe,ge,Me,Te,ie,Rt,it],encapsulation:2,changeDetection:0});let n=o;return n})();var yi=()=>["/"];function Ti(n,o){n&1&&(u(0,"a",3),m(1,"\u5168\u90E8\u5E94\u7528"),r()),n&2&&a("routerLink",F(1,yi))}function Mi(n,o){if(n&1){let l=B();u(0,"nz-tab",6),d("nzClick",function(){let t=_(l).$implicit,c=g(2);return C(c.to(t))}),r()}if(n&2){let l=o.$implicit;a("nzTitle",l.tab)}}function ji(n,o){if(n&1&&(u(0,"h1"),m(1),r(),u(2,"nz-tabset",4),E(3,Mi,1,1,"nz-tab",5),r()),n&2){let l=g();ht("margin-bottom",0),s(1),gt("",l.project==null?null:l.project.Name," ",l.project==null?null:l.project.ApiAddress,""),s(1),a("nzSelectedIndex",l.pos),s(1),a("ngForOf",l.tabs)}}var wi=()=>({"padding-top":"0"}),ot=(()=>{let o=class o{constructor(e,i,t,c,p){this.activatedRouter=e,this.router=i,this.http=t,this.modalSrv=c,this.cdr=p,this.tabs=[{key:"model-tree",tab:"\u5E94\u7528\u6A21\u578B"},{key:"device-list",tab:"\u865A\u62DF\u8BBE\u5907"},{key:"device-security",tab:"\u8BBE\u5907\u5B89\u5168"},{key:"data-storage",tab:"\u6570\u636E\u5B58\u50A8"}],this.loading=!0,this.project=null,this.pos=0,this.projectId=""}setActive(){let e=this.router.url.substring(this.router.url.lastIndexOf("/")+1),i=this.tabs.findIndex(t=>e.startsWith(t.key));i!==-1&&(this.pos=i)}ngOnInit(){this.router$=this.router.events.pipe(ct(e=>e instanceof vt)).subscribe(()=>this.setActive()),this.setActive(),this.activatedRouter.queryParams.subscribe(e=>{this.projectId=e?.projectId,this.http.post("controlpanel/www",{function:"GetProjectInfo",projectId:this.projectId}).subscribe(i=>{i.Status==200&&i.Data!=null?this.project=i.Data:i.Status!=200&&this.modalSrv.error({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${i.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${i.Message}`}),this.loading=!1,this.cdr.detectChanges()})})}to(e){this.router.navigate([`/project/project-design/${e.key}`],{queryParams:{projectId:this.projectId}})}ngOnDestroy(){this.router$.unsubscribe()}};o.\u0275fac=function(i){return new(i||o)(f(H),f(Se),f(M),f(T),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-project-design"]],decls:6,vars:6,consts:[[1,"tabs-card",3,"nzLoading","nzBordered","nzTitle","nzExtra","nzBodyStyle"],["extraTemplate1",""],["tagTitleTpl",""],["nz-button","","nzType","primary",3,"routerLink"],["nzSize","small",3,"nzSelectedIndex"],[3,"nzTitle","nzClick",4,"ngFor","ngForOf"],[3,"nzTitle","nzClick"]],template:function(i,t){if(i&1&&(u(0,"nz-card",0),E(1,Ti,2,2,"ng-template",null,1,S)(3,ji,4,6,"ng-template",null,2,S),h(5,"router-outlet"),r()),i&2){let c=v(2),p=v(4);a("nzLoading",t.loading)("nzBordered",!1)("nzTitle",p)("nzExtra",c)("nzBodyStyle",F(5,wi))}},dependencies:[te,zt,ce,x,b,Lt,Vt,K],styles:[".avatar-holder[_ngcontent-%COMP%]{margin-bottom:24px;text-align:center}.avatar-holder[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{width:104px;height:104px;margin-bottom:20px}.avatar-holder[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin-bottom:4px;color:#000000d9;font-weight:500;font-size:20px;line-height:28px}.detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{position:relative;margin-bottom:8px;padding-left:26px}.detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}.detail[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;top:4px;left:0;width:14px;height:14px;background:url(https://gw.alipayobjects.com/zos/rmsportal/pBjWzVAHnOOtAUvZmZfy.svg)}.detail[_ngcontent-%COMP%]   i.title[_ngcontent-%COMP%]{background-position:0 0}.detail[_ngcontent-%COMP%]   i.group[_ngcontent-%COMP%]{background-position:0 -22px}.detail[_ngcontent-%COMP%]   i.address[_ngcontent-%COMP%]{background-position:0 -44px}.tags-title[_ngcontent-%COMP%], .team-title[_ngcontent-%COMP%]{margin-bottom:12px;color:#000000d9;font-weight:500}.tags[_ngcontent-%COMP%]     .ant-tag{margin-bottom:8px}.team[_ngcontent-%COMP%]     .ant-avatar{margin-right:12px}.team[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;margin-bottom:24px;color:#000000d9;transition:color .3s}.team[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#1890ff}.tabs-card[_ngcontent-%COMP%]     .ant-card-head-title{padding:0 16px}"],changeDetection:0});let n=o;return n})();var Pi=()=>({minRows:4}),rt=(()=>{let o=class o{constructor(e,i,t,c){this.fb=e,this.msg=i,this.modal=t,this.cdr=c,this.submitting=!1,this.list=[],this.nzModalData=le(me)}ngOnInit(){this.projectInfo=this.nzModalData.projectInfo,this.list=this.nzModalData.list,this.form=this.fb.group({Name:[this.projectInfo.Name,[I.required]],ApiAddress:[this.projectInfo.ApiAddress,[I.required]],Desc:[this.projectInfo.Desc,[]],LogLevel:[this.projectInfo.LogLevel==null?"Warning":this.projectInfo.LogLevel,[]]})}SiteCode(){return this.projectInfo.Id}destroyModal(e){this.modal.destroy(e)}submit(){this.submitting=!0;let e=this.form.value.ApiAddress;if(e!=null&&(e=e.trim(),e=e.replace(/[\\/]+$/g,""),e.toLowerCase().startsWith("http://")||(e=`http://${e}`)),this.list.find(i=>i.ApiAddress.toLocaleLowerCase()==e.toLocaleLowerCase())){this.msg.error("api\u5730\u5740\u4E0D\u80FD\u91CD\u590D"),this.submitting=!1;return}setTimeout(()=>{this.submitting=!1,this.destroyModal({Id:this.projectInfo.Id,Name:this.form.value.Name,Desc:this.form.value.Desc,LogLevel:this.form.value.LogLevel,ApiAddress:e,Deployed:this.projectInfo.Deployed==null?!1:this.projectInfo.Deployed}),this.msg.success("\u4FDD\u5B58\u6210\u529F"),this.cdr.detectChanges()},1e3)}cancel(){this.destroyModal(null)}};o.\u0275fac=function(i){return new(i||o)(f(R),f(y),f(pe),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-project-form"]],inputs:{projectInfo:"projectInfo",list:"list"},decls:24,vars:7,consts:[[3,"nzBordered"],["nz-form","","se-container","1","labelWidth","200",3,"formGroup"],["label","\u540D\u79F0","error","\u8BF7\u8F93\u5165\u4E00\u4E2A\u597D\u8BB0\u7684\u5E94\u7528\u540D\u79F0","required",""],["nz-input","","formControlName","Name","placeholder","\u7ED9\u5E94\u7528\u8D77\u4E2A\u540D\u5B57"],["label","Api\u5730\u5740","error","\u8BF7\u8F93\u5165\u4E00\u4E2A\u597D\u8BB0\u7684\u5E94\u7528Api\u5165\u53E3\u5730\u5740","required",""],["nz-input","","formControlName","ApiAddress","placeholder","\u8BF7\u8F93\u5165\u4E00\u4E2A\u597D\u8BB0\u7684\u5E94\u7528Api\u5165\u53E3\u5730\u5740: http://192.168.31.217:9001/"],["label","\u7AD9\u70B9\u7F16\u7801"],["label","\u65E5\u5FD7\u7EA7\u522B"],["formControlName","LogLevel"],["nz-radio","","nzValue","Error"],["nz-radio","","nzValue","Warning"],["nz-radio","","nzValue","Trace"],["label","\u63CF\u8FF0","error","\u8BF7\u8F93\u5165\u5E94\u7528\u63CF\u8FF0"],["nz-input","","formControlName","Desc","placeholder","\u8BF7\u8F93\u5165\u5E94\u7528\u63CF\u8FF0",3,"nzAutosize"],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["nz-button","",1,"ml-sm",3,"click"]],template:function(i,t){i&1&&(u(0,"nz-card",0)(1,"form",1)(2,"se",2),h(3,"input",3),r(),u(4,"se",4),h(5,"input",5),r(),u(6,"se",6)(7,"span"),m(8),r()(),u(9,"se",7)(10,"nz-radio-group",8)(11,"label",9),m(12,"Error"),r(),u(13,"label",10),m(14,"Warning"),r(),u(15,"label",11),m(16,"Trace"),r()()(),u(17,"se",12),h(18,"textarea",13),r(),u(19,"se")(20,"button",14),d("click",function(){return t.submit()}),m(21,"\u4FDD\u5B58"),r(),u(22,"button",15),d("click",function(){return t.cancel()}),m(23,"\u53D6\u6D88"),r()()()()),i&2&&(a("nzBordered",!1),s(1),a("formGroup",t.form),s(7),se(t.SiteCode()),s(10),a("nzAutosize",F(6,Pi)),s(2),a("disabled",t.form.invalid)("nzLoading",t.submitting))},dependencies:[P,k,j,w,V,L,$,G,x,b,N,Z,ne,Q,W,O,K],encapsulation:2,changeDetection:0});let n=o;return n})();var Kt=Be(Fe());var Vi=()=>["/"];function Li(n,o){n&1&&(u(0,"nz-breadcrumb")(1,"nz-breadcrumb-item")(2,"a",9),m(3,"\u9996\u9875"),r()(),u(4,"nz-breadcrumb-item"),m(5,"\u5168\u90E8\u5E94\u7528"),r()()),n&2&&(s(2),a("routerLink",F(1,Vi)))}function Ri(n,o){if(n&1){let l=B();u(0,"a",19),d("click",function(){_(l);let i=g(2).$implicit,t=g();return C(t.editProject(i))}),m(1,"\u7F16\u8F91\u5E94\u7528"),r()}}function $i(n,o){if(n&1){let l=B();u(0,"a",19),d("click",function(){_(l);let i=g(2).$implicit,t=g();return C(t.designProject(i))}),m(1,"\u8BBE\u8BA1\u5E94\u7528\u6A21\u578B"),r()}}function Gi(n,o){if(n&1){let l=B();u(0,"li",6),d("click",function(){_(l);let i=g(3).$implicit,t=g();return C(t.deployProject(i))}),m(1,"\u53D1\u5E03\u5E94\u7528"),r()}}function Ui(n,o){if(n&1){let l=B();u(0,"li",6),d("click",function(){_(l);let i=g(3).$implicit,t=g();return C(t.deployProject(i))}),m(1,"\u91CD\u65B0\u53D1\u5E03\u5E94\u7528"),r()}}function qi(n,o){if(n&1){let l=B();u(0,"li",6),d("click",function(){_(l);let i=g(3).$implicit,t=g();return C(t.undeployProject(i))}),m(1,"\u5378\u8F7D\u5E94\u7528"),r()}}function Ji(n,o){n&1&&h(0,"li",24)}function Hi(n,o){if(n&1){let l=B();u(0,"li",6),d("click",function(){_(l);let i=g(3).$implicit,t=g();return C(t.deleteProject(i))}),m(1,"\u5220\u9664\u5E94\u7528"),r()}}var Wi=n=>({function:"UploadProject",projectId:n});function Qi(n,o){if(n&1){let l=B();h(0,"i",20),u(1,"nz-dropdown-menu",null,21),h(3,"i",22),u(4,"ul",5),E(5,Gi,2,0,"li",23)(6,Ui,2,0,"li",23)(7,qi,2,0,"li",23),h(8,"li",24),u(9,"nz-upload",25),d("nzChange",function(i){_(l);let t=g(3);return C(t.handleFileStatusChange(i))}),u(10,"li",26),m(11,"\u5BFC\u5165\u5E94\u7528"),r()(),u(12,"li",6),d("click",function(){_(l);let i=g(2).$implicit,t=g();return C(t.exportProject(i))}),m(13,"\u5BFC\u51FA\u5E94\u7528"),r(),E(14,Ji,1,0,"li",27)(15,Hi,2,0,"li",23),r()()}if(n&2){let l=v(2),e=g(2).$implicit;a("nzDropdownMenu",l),s(5),a("ngIf",!e.Deployed),s(1),a("ngIf",e.Deployed),s(1),a("ngIf",e.Deployed),s(2),a("nzData",Dt(7,Wi,e.Id)),s(5),a("ngIf",!e.Deployed),s(1),a("ngIf",!e.Deployed)}}function Zi(n,o){}function Ki(n,o){n&1&&h(0,"nz-badge",30)}function Xi(n,o){n&1&&(u(0,"span"),m(1,"[\u5DF2\u53D1\u5E03]"),r())}function Yi(n,o){if(n&1&&(E(0,Ki,1,0,"nz-badge",28)(1,Xi,2,0,"span",29),m(2),h(3,"br"),u(4,"span"),m(5),r()),n&2){let l=g(2).$implicit;a("ngIf",l.IsRunning),s(1),a("ngIf",l.Deployed),s(1),ve("",l.Name," "),s(3),ve("Api\u5730\u5740 : ",l.ApiAddress,"")}}function en(n,o){if(n&1&&(u(0,"ellipsis",31),m(1),r()),n&2){let l=g(2).$implicit;s(1),se(l.Desc)}}var tn=(n,o,l)=>[n,o,l];function nn(n,o){if(n&1&&(u(0,"nz-card",11),E(1,Ri,2,0,"ng-template",null,12,S)(3,$i,2,0,"ng-template",null,13,S)(5,Qi,16,9,"ng-template",null,14,S),u(7,"nz-card-meta",15),E(8,Zi,0,0,"ng-template",null,16,S)(10,Yi,6,4,"ng-template",null,17,S)(12,en,2,1,"ng-template",null,18,S),r()()),n&2){let l=v(2),e=v(4),i=v(6),t=v(9),c=v(11),p=v(13);a("nzActions",Ct(4,tn,l,e,i)),s(7),a("nzAvatar",t)("nzTitle",c)("nzDescription",p)}}function un(n,o){if(n&1&&(u(0,"nz-list-item"),E(1,nn,14,8,"nz-card",10),r()),n&2){let l=o.$implicit;s(1),a("ngIf",l!==null)}}var on=()=>({gutter:24,lg:8,md:12,sm:24,xs:24}),at=(()=>{let o=class o{constructor(e,i,t,c,p){this.http=e,this.msg=i,this.modalSrv=t,this.router=c,this.cdr=p,this.list=[],this.loading=!0,this.runningApps=[],this.defaultProject={Id:"",Name:"\u65B0\u5EFA\u5E94\u7528",Desc:"\u65B0\u5EFA\u5E94\u7528\u7684\u63CF\u8FF0",ApiAddress:"http://localhost:9001",Deployed:!1,LogLevel:"Warning"}}ngOnInit(){this.runningApps!=null&&this.runningApps.length>0&&this.runningApps.forEach(e=>{if(e.TimeoutId!=null)try{clearTimeout(e.TimeoutId),e.TimeoutId=null}catch{}}),this.http.post("controlpanel/www",{function:"GetProjectInfos"}).subscribe(e=>{if(e.Status==200&&e.Data!=null){this.list=e.Data,this.list.forEach(t=>{t.IsRunning=!1});let i=this.list.filter(t=>t?.Deployed);i.length>0&&i.forEach(t=>{if(t?.ApiAddress!=null&&t.ApiAddress.trim()!=""){t.IsRunning=!1;let c=`${t.ApiAddress}/service/KeepAlive`;this.keepAlive(t.Id,c)}})}else e.Status!=200&&this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${e.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${e.Message}`});this.loading=!1,this.cdr.detectChanges()})}keepAlive(e,i){e==null||e.trim()==""||i==null||i.trim()==""||this.http.get(i).subscribe({next:t=>{if(t.Status==200&&t.Data!=null&&e==t.Data){let D=this.list.find(Ue=>Ue?.Id==e);D!=null&&(D.IsRunning=!0),this.runningApps.find(Ue=>Ue.Id==e)==null&&this.runningApps.push({Id:e,TimeoutId:null})}this.cdr.detectChanges();let c=setTimeout(this.keepAlive.bind(this,e,i),2e3),p=this.runningApps.find(D=>D.Id==e);p!=null&&(p.TimeoutId=c)},error:()=>{let t=this.runningApps.find(p=>p.Id==e);t==null&&this.runningApps.push({Id:e,TimeoutId:null});let c=this.list.find(p=>p?.Id==e);if(c!=null&&(c.IsRunning=!1,c.Deployed)){let p=setTimeout(this.keepAlive.bind(this,e,i),2e3);t=this.runningApps.find(D=>D.Id==e),t!=null&&(t.TimeoutId=p)}this.cdr.detectChanges()}})}UpdateProjects(){this.loading=!0;var e=this.list;this.http.post("controlpanel/www",{function:"UpdateProjectInfos",data:e}).subscribe(i=>{i.Status!=200&&this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${i.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${i.Message}`}),this.loading=!1,this.cdr.detectChanges()})}designProject(e){let i=e;this.router.navigate(["/project/project-design/model-tree"],{queryParams:{projectId:i.Id}})}addNewProject(){let e=JSON.parse(JSON.stringify(this.defaultProject));e.Id=Kt.UUID.UUID(),this.editNewProjectInternal(e,"\u65B0\u5EFA\u5E94\u7528",this.list)}editProject(e){this.editNewProjectInternal(e,"\u7F16\u8F91\u5E94\u7528",this.list)}editNewProjectInternal(e,i,t){this.modalSrv.create({nzTitle:i,nzWidth:800,nzStyle:{top:"10px"},nzContent:rt,nzFooter:null,nzData:{projectInfo:e,list:t.filter(p=>p?.Id!=e.Id)}}).afterClose.subscribe(p=>{if(p!=null&&p.Id!=null&&p.Id!=""){let D=this.list.find(q=>q?.Id==p.Id);D!=null?(D.Name=p.Name,D.Desc=p.Desc,D.Avatar="",D.LogLevel=p.LogLevel,D.ApiAddress=p.ApiAddress,D.Deployed=p.Deployed,this.UpdateProjects(),this.cdr.detectChanges()):(this.list=this.list.concat([{Id:p.Id,Name:p.Name,Desc:p.Desc,Avatar:"",ApiAddress:p.ApiAddress,Deployed:!1,IsRunning:!1,LogLevel:p.LogLevel}]),this.UpdateProjects(),this.cdr.detectChanges())}})}undeployProject(e){this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u5378\u8F7D\u8FD0\u884C\u7684\u8BE5\u5E94\u7528\uFF1F</i>",nzContent:e.Name,nzOnOk:()=>{let i=this.list.find(t=>t?.Id==e.Id);i!=null&&i!=null&&(this.loading=!0,this.http.post("controlpanel/www",{function:"UndeployProject",projectId:e.Id}).subscribe(t=>{t.Status!=200&&this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${t.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${t.Message}`}),this.ngOnInit(),this.loading=!1,this.cdr.detectChanges()}))}})}deployProject(e){this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u53D1\u5E03/\u8FD0\u884C\u8BE5\u5E94\u7528\uFF1F</i>",nzContent:e.Name,nzOnOk:()=>{this.list.find(t=>t?.Id==e.Id)!=null&&(this.loading=!0,this.http.post("controlpanel/www",{function:"DeployProject",projectId:e.Id}).subscribe(t=>{t.Status!=200&&(t.Status==19?this.modalSrv.info({nzTitle:"\u6B64\u5E94\u7528\u6CA1\u6709\u4EFB\u4F55\u7684\u914D\u7F6E\uFF0C\u8BF7\u914D\u7F6E\u6B64\u5E94\u7528\u3002"}):this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${t.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${t.Message}`})),this.ngOnInit(),this.loading=!1,this.cdr.detectChanges()}))}})}handleFileStatusChange(e){e.file.status!=="uploading"&&console.log(e.file,e.fileList),e.file.status==="done"?this.msg.success(`${e.file.name} \u6587\u4EF6\u4E0A\u6B21\u6210\u529F\uFF01`):e.file.status==="error"&&this.msg.error(`${e.file.name} \u6587\u4EF6\u4E0A\u6B21\u5931\u8D25.`)}exportProject(e){this.list.find(t=>t?.Id==e.Id)!=null&&(this.loading=!0,this.http.post("controlpanel/downloadfile",{function:"DownloadProject",projectId:e.Id},null,{responseType:"blob"}).subscribe(t=>{this.loading=!1,this.SaveFile(t,e.Name)}))}SaveFile(e,i){let t=document.createElement("a"),c=new Blob([e],{type:"application/json"});t.href=URL.createObjectURL(c),t.download=`${i}.json`,t.click(),t.remove()}deleteProject(e){let i=this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5E94\u7528\uFF1F</i>",nzContent:e.Name,nzOnOk:()=>{let t=this.list.findIndex(c=>c?.Id==e.Id);if(t>=0){this.loading=!0;let c=this.list;c.splice(t,1),this.list=c,this.UpdateProjects(),this.cdr.detectChanges(),this.loading=!1}}})}startAllDepolyedProjects(){if(this.list.filter(t=>t?.Deployed).length==0){this.msg.info("\u6CA1\u6709\u53D1\u5E03\u7684\u5E94\u7528\u53EF\u4EE5\u8FD0\u884C\uFF01");return}let i=this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u8FD0\u884C\u5168\u90E8\u5DF2\u53D1\u5E03\u7684\u5E94\u7528\uFF1F</i>",nzOnOk:()=>{this.loading=!0,this.http.post("controlpanel/www",{function:"StartDeployedProjects"}).subscribe(t=>{t.Status!=200&&this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${t.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${t.Message}`}),this.ngOnInit(),this.loading=!1,this.cdr.detectChanges()})}})}stopAllDepolyedProjects(){if(this.list.filter(t=>t?.Deployed).length==0){this.msg.info("\u6CA1\u6709\u8FD0\u884C\u4E2D\u7684\u5E94\u7528\uFF01");return}let i=this.modalSrv.confirm({nzTitle:"<i>\u786E\u5B9A\u8981\u505C\u6B62\u5168\u90E8\u8FD0\u884C\u4E2D\u7684\u5E94\u7528\uFF1F</i>",nzOnOk:()=>{this.loading=!0,this.http.post("controlpanel/www",{function:"StopDeployedProjects"}).subscribe(t=>{t.Status!=200&&this.modalSrv.info({nzTitle:`\u64CD\u4F5C\u51FA\u9519\uFF01\u9519\u8BEF\u4EE3\u7801\uFF1A${t.Status}; \u9519\u8BEF\u4FE1\u606F\uFF1A${t.Message}`}),this.list.forEach(c=>{c.IsRunning=!1}),this.runningApps!=null&&this.runningApps.length>0&&this.runningApps.forEach(c=>{if(c.TimeoutId!=null)try{clearTimeout(c.TimeoutId),c.TimeoutId=null}catch{}}),this.loading=!1,this.cdr.detectChanges()})}})}};o.\u0275fac=function(i){return new(i||o)(f(M),f(y),f(T),f(Se),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-project-list"]],decls:17,vars:9,consts:[[3,"breadcrumb","autoTitle"],["breadcrumb",""],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzType"],["nz-icon","","nzType","plus"],["menu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"click"],[3,"nzLoading","nzDataSource","nzRenderItem","nzGrid"],["item",""],[3,"routerLink"],["nzHoverable","",3,"nzActions",4,"ngIf"],["nzHoverable","",3,"nzActions"],["op1",""],["op2",""],["op3",""],[3,"nzAvatar","nzTitle","nzDescription"],["nzAvatar",""],["nzTitle",""],["nzDescription",""],[3,"click"],["nz-dropdown","","nzPlacement","bottomLeft","nz-icon","","nzType","ellipsis",3,"nzDropdownMenu"],["op4Menu","nzDropdownMenu"],["nz-dropdown","","nz-icon","","nzType","ellipsis"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-divider",""],["nzAccept",".json","nzShowUploadList","false","nzAction","controlpanel/uploadfile",3,"nzData","nzChange"],["nz-menu-item",""],["nz-menu-divider","",4,"ngIf"],["nzStatus","processing",4,"ngIf"],[4,"ngIf"],["nzStatus","processing"],["lines","4","tooltip",""]],template:function(i,t){if(i&1&&(u(0,"page-header",0),E(1,Li,6,2,"ng-template",null,1,S),r(),u(3,"button",2),h(4,"i",3),u(5,"span"),m(6,"\u65B0\u5EFA\u5E94\u7528"),r()(),u(7,"nz-dropdown-menu",null,4)(9,"ul",5)(10,"li",6),d("click",function(){return t.addNewProject()}),u(11,"a"),m(12,"\u65B0\u5EFA\u7A7A\u5E94\u7528"),r()()()(),h(13,"br"),u(14,"nz-list",7),E(15,un,2,1,"ng-template",null,8,S),r()),i&2){let c=v(2),p=v(8),D=v(16);a("breadcrumb",c)("autoTitle",!1),s(3),a("nzDropdownMenu",p)("nzType","primary"),s(11),a("nzLoading",t.loading)("nzDataSource",t.list)("nzRenderItem",D)("nzGrid",F(8,on))}},dependencies:[J,ce,Pe,x,b,N,he,fe,xt,Ie,ge,Ne,xe,ie,we,je,ke,Ve,Oe,K,Ot,$t,Ut],styles:["[_nghost-%COMP%]     .ant-card-meta-title{margin-bottom:12px}"],changeDetection:0});let n=o;return n})();var rn=["st"],an=()=>["/"];function ln(n,o){n&1&&(u(0,"nz-breadcrumb")(1,"nz-breadcrumb-item")(2,"a",14),m(3,"\u9996\u9875"),r()(),u(4,"nz-breadcrumb-item"),m(5,"\u65E5\u5FD7"),r()()),n&2&&(s(2),a("routerLink",F(1,an)))}function sn(n,o){if(n&1&&h(0,"nz-option",15),n&2){let l=o.$implicit;a("nzLabel",l.text)("nzValue",l.datavalue)}}function cn(n,o){if(n&1&&h(0,"nz-badge",16),n&2){let l=o.$implicit;a("nzStatus",l.statusType)("nzText",l.statusText)}}var mn=()=>({xs:8,sm:8,md:8,lg:24,xl:48,xxl:48}),pn=()=>({y:"640px"}),lt=(()=>{let o=class o{constructor(e,i,t,c){this.http=e,this.msg=i,this.modalSrv=t,this.cdr=c,this.q={level:"",days:30},this.data=[],this.loading=!1,this.loglevel=[{index:0,text:"TRACE",datavalue:"TRACE",value:!1,type:"default",checked:!1},{index:1,text:"DEBUG",datavalue:"DEBUG",value:!1,type:"default",checked:!1},{index:2,text:"INFO",datavalue:"INFO",value:!1,type:"default",checked:!1},{index:3,text:"WARN",datavalue:"WARN",value:!1,type:"warning",checked:!1},{index:4,text:"ERROR",datavalue:"ERROR",value:!1,type:"error",checked:!1}],this.page={front:!1,show:!1},this.columns=[{title:"\u65E5\u671F",index:"Date",type:"date",sort:{compare:(p,D)=>p.Date-D.Date},fixed:"left",width:200},{title:"\u7EA7\u522B",index:"Level",render:"Level",filter:{menus:this.loglevel,fn:(p,D)=>D.Level===p.datavalue},fixed:"left",width:100},{title:"\u8BB0\u5F55\u6765\u6E90",index:"Logger"},{title:"\u6D88\u606F",index:"Message"},{title:"\u9519\u8BEF\u5185\u5BB9",index:"Exception"}],this.selectedRows=[],this.description="",this.totalCallNo=0,this.expandForm=!1}ngOnInit(){this.getData()}getData(){this.loading=!0,this.http.post("controlpanel/www",{function:"GetRuntimeLog",level:this.q.level,days:this.q.days}).pipe(st(e=>e.Data.map(i=>{let t=this.loglevel.find(c=>c.datavalue===i.Level);return t!=null&&(i.statusText=t.text,i.statusType=t.type),i.Date=new Date(i.Date),i})),pt(()=>this.loading=!1)).subscribe(e=>{this.data=e,this.cdr.detectChanges()})}stChange(e){switch(e.type){case"filter":this.getData();break}}clearAll(){this.q.days=-1e3,setTimeout(()=>this.getData())}searchByDays(e){this.q.days=e,setTimeout(()=>this.getData())}reset(){setTimeout(()=>this.getData())}};o.\u0275fac=function(i){return new(i||o)(f(M),f(y),f(T),f(A))},o.\u0275cmp=z({type:o,selectors:[["app-project-log"]],viewQuery:function(i,t){if(i&1&&Ft(rn,7),i&2){let c;Et(c=Bt())&&(t.st=c.first)}},decls:36,vars:26,consts:[[3,"breadcrumb","autoTitle"],["breadcrumb",""],[3,"nzBordered"],["nz-form","",1,"search__form",3,"ngSubmit"],["nz-row","",3,"nzGutter"],["nz-col","","nzMd","8","nzSm","24"],["nzFor","status"],["name","status","id","status","nzAllowClear","",3,"ngModel","nzPlaceHolder","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-button","",3,"nzType","nzLoading","click"],["nz-button","",3,"nzLoading","click"],[3,"columns","data","loading","page","scroll","change"],["st",""],["st-row","Level"],[3,"routerLink"],[3,"nzLabel","nzValue"],[3,"nzStatus","nzText"]],template:function(i,t){if(i&1){let c=B();u(0,"page-header",0),E(1,ln,6,2,"ng-template",null,1,S),r(),u(3,"nz-card",2)(4,"form",3),d("ngSubmit",function(){return t.getData()}),u(5,"div",4)(6,"div",5)(7,"nz-form-item")(8,"nz-form-label",6),m(9,"\u65E5\u5FD7\u7EA7\u522B"),r(),u(10,"nz-form-control")(11,"nz-select",7),d("ngModelChange",function(D){return t.q.level=D}),E(12,sn,1,2,"nz-option",8),r()()()(),u(13,"button",9),d("click",function(){return t.searchByDays(7)}),u(14,"span"),m(15,"\u6700\u8FD1\u4E00\u5468"),r()(),u(16,"button",9),d("click",function(){return t.searchByDays(30)}),u(17,"span"),m(18,"\u6700\u8FD1\u4E00\u4E2A\u6708"),r()(),u(19,"button",9),d("click",function(){return t.searchByDays(90)}),u(20,"span"),m(21,"\u6700\u8FD13\u4E2A\u6708"),r()(),u(22,"button",9),d("click",function(){return t.searchByDays(180)}),u(23,"span"),m(24,"\u6700\u8FD1\u534A\u5E74"),r()(),u(25,"button",9),d("click",function(){return t.searchByDays(365)}),u(26,"span"),m(27,"\u6700\u8FD1\u4E00\u5E74"),r()(),u(28,"button",10),d("click",function(){_(c);let D=v(34);return C(D.export(t.data,{filename:"sunup-log.xlsx",sheetname:"log"}))}),m(29,"\u5BFC\u51FA\u65E5\u5FD7"),r(),u(30,"button",10),d("click",function(){return t.clearAll()}),u(31,"span"),m(32,"\u6E05\u7A7A\u65E5\u5FD7"),r()()()(),u(33,"st",11,12),d("change",function(D){return t.stChange(D)}),E(35,cn,1,2,"ng-template",13),r()()}if(i&2){let c=v(2);a("breadcrumb",c)("autoTitle",!1),s(3),a("nzBordered",!1),s(2),a("nzGutter",F(24,mn)),s(6),a("ngModel",t.q.level)("nzPlaceHolder","\u8BF7\u9009\u62E9"),s(1),a("ngForOf",t.loglevel),s(1),a("nzType","primary")("nzLoading",t.loading),s(3),a("nzType","primary")("nzLoading",t.loading),s(3),a("nzType","primary")("nzLoading",t.loading),s(3),a("nzType","primary")("nzLoading",t.loading),s(3),a("nzType","primary")("nzLoading",t.loading),s(3),a("nzLoading",t.loading),s(2),a("nzLoading",t.loading),s(3),a("columns",t.columns)("data",t.data)("loading",t.loading)("page",t.page)("scroll",F(25,pn))}},dependencies:[te,P,j,w,de,At,ce,Mt,Tt,Pe,x,b,N,Me,Te,Nt,yt,ie,we,je,O,jt,Pt,wt,K],encapsulation:2,changeDetection:0});let n=o;return n})();var dn=[{path:"",redirectTo:"project-list",pathMatch:"full"},{path:"project-list",component:at},{path:"project-log",component:lt},{path:"project-design",component:ot,children:[{path:"",redirectTo:"model-tree",pathMatch:"full"},{path:"model-tree",component:ut,data:{titleI18n:"app.project.model"}},{path:"device-list",component:et,data:{titleI18n:"app.project.device"}},{path:"device-security",component:tt,data:{titleI18n:"app.project.devicesecurity"}},{path:"data-storage",component:He,data:{titleI18n:"app.project.datastorage"}}]}],Xt=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=be({type:o}),o.\u0275inj=Ae({imports:[qe.forChild(dn),qe]});let n=o;return n})();var Mu=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=be({type:o}),o.\u0275inj=Ae({imports:[Gt,Xt,qt]});let n=o;return n})();export{Mu as ProjectModule};
